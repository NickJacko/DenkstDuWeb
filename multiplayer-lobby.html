<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>No-Cap - Multiplayer Lobby</title>

    <!-- ? SECURITY: Security Headers -->
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">

    <!-- ? P0 SECURITY: Domain Whitelist Public Key -->
    <meta name="domain-whitelist-public-key" content="-----BEGIN PUBLIC KEY-----MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAgJ2dp2d2iufGYuz+rdUiaZZkl4ig0H90wRfZGSl2YH+RvP4TyLhmeW1FfmHXEJthWeZCFSoVEvJ6Sv77LryPYnZt8at0a4o5KDdsBWXNn5vtg5uKsIzhC8KF7vjPtRm9omt5lnUUALibbNSkzEgYNMllzlnUjDZPOcWGUj+LUraG4nkpunhzsmosctLY/EcgN3g5Mx9F066fnBECnWzQZZfRHowIIW+1tLF1it3Ngqkprf4WG0bE9AfgziYUuP64hw9zUMCkovb7RLzPDw5w9BdBxo9/GUwV7AQAw4KsWgJaHmueB6e21FrqKaJ45NooJMDjimo9WBAEiMEL8fbZGwIDAQAB-----END PUBLIC KEY-----">
    <!-- ? P0 SECURITY: Firebase Config via Meta Tags (CSP-compliant) -->
    <meta name="firebase-api-key" content="AIzaSyC_cu_2X2uFCPcxYetxIUHi2v56F1Mz0Vk">
    <meta name="firebase-auth-domain" content="denkstduwebsite.firebaseapp.com">
    <meta name="firebase-database-url" content="https://denkstduwebsite-default-rtdb.europe-west1.firebasedatabase.app">
    <meta name="firebase-project-id" content="denkstduwebsite">
    <meta name="firebase-storage-bucket" content="denkstduwebsite.firebasestorage.app">
    <meta name="firebase-messaging-sender-id" content="27029260611">
    <meta name="firebase-app-id" content="1:27029260611:web:3c7da4db0bf92e8ce247f6">
    <meta name="firebase-measurement-id" content="G-BNKNW95HK8">
    <meta name="firebase-app-check-key" content="6LeSPUQsAAAAANnUhOAey-M8Mgr0eeT9-inR7wKZ">
    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ®</text></svg>">

    <!-- ? SECURITY: External CSS ONLY (no inline styles) -->
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" href="/assets/css/multiplayer-lobby.css">

    <!-- ? SECURITY: DOMPurify lokal gehostet -->
    <script src="/assets/lib/purify.min.js"></script>

    <!-- ? SECURITY: Firebase SDK with crossorigin -->
    <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js" crossorigin="anonymous"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js" crossorigin="anonymous"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js" crossorigin="anonymous"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-functions-compat.js" crossorigin="anonymous"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-check-compat.js" crossorigin="anonymous"></script>
    <!-- QRCode.js for QR Code Generation -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
            integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>

    <!-- ? SECURITY: Core Scripts in correct dependency order -->
    <script defer src="/assets/js/GameState.js"></script>
    <script defer src="/assets/js/utils.js"></script>
    <script defer src="/assets/js/firebase-config.js"></script>
    <script defer src="/assets/js/firebase-service.js"></script>
    <script defer src="/assets/js/multiplayer-lobby.js"></script>


</head>
<body>
<!-- Background Particles -->
<div class="background-particles" aria-hidden="true">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
</div>

<!-- Loading Spinner -->
<div class="loading" id="loading" role="status" aria-live="polite">
    <div class="spinner" aria-hidden="true"></div>
    <p class="loading-text">Verbinde mit Firebase...</p>
</div>

<!-- App Container -->
<div class="app-container">
    <h1 class="screen-title">ğŸ® Multiplayer Lobby</h1>

    <div class="glass-card">
        <!-- Game Info Section -->
        <section class="game-info" role="region" aria-labelledby="game-info-title">
            <h2 id="game-info-title" class="sr-only">Spiel-Beitrittsinformationen</h2>

            <div class="info-grid">
                <!-- âœ… NEUE QR-CODE SECTION MIT SHARE-BUTTONS -->
                <div class="info-item qr-section-centered">
                    <div class="info-label" id="qr-code-label">QR-Code scannen</div>
                    <div class="qr-code-wrapper">
                        <!-- âœ… Centered QR Code -->
                        <div class="qr-code-container"
                             id="qr-code"
                             role="img"
                             aria-labelledby="qr-code-label qr-code-description">
                            <div class="qr-loading" aria-hidden="true">
                                <div class="spinner-small"></div>
                                <span>Generiere QR-Code...</span>
                            </div>
                        </div>

                        <!-- âœ… Game Code Display Below QR -->
                        <div class="qr-text-code" id="qr-text-code" aria-live="polite">
                            <span class="code-prefix">Spiel-Code:</span>
                            <span class="code-value" id="qr-code-text">------</span>
                        </div>

                        <!-- âœ… Social Share Buttons -->
                        <div class="share-buttons" id="share-buttons">
                            <button class="share-btn share-whatsapp"
                                    id="share-whatsapp-btn"
                                    type="button"
                                    aria-label="Per WhatsApp teilen">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                                </svg>
                                <span>WhatsApp</span>
                            </button>

                            <button class="share-btn share-telegram"
                                    id="share-telegram-btn"
                                    type="button"
                                    aria-label="Per Telegram teilen">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                                </svg>
                                <span>Telegram</span>
                            </button>

                            <button class="share-btn share-copy"
                                    id="share-copy-btn"
                                    type="button"
                                    aria-label="Link kopieren">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                                </svg>
                                <span>Link kopieren</span>
                            </button>

                            <button class="share-btn share-native"
                                    id="share-native-btn"
                                    type="button"
                                    aria-label="Nativ teilen"
                                    hidden>
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
                                </svg>
                                <span>Teilen</span>
                            </button>
                        </div>

                        <!-- âœ… QR Code Description for Accessibility -->
                        <div id="qr-code-description" class="qr-description">
                            <small>Scannen Sie den QR-Code oder teilen Sie den Link mit Ihren Freunden</small>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Game Settings -->
        <aside class="game-settings" role="region" aria-labelledby="settings-title">
            <h2 id="settings-title" class="settings-title">âš™ï¸ Einstellungen</h2>

            <div class="setting-row">
                <div class="setting-header">Schwierigkeit</div>
                <div class="setting-content" id="difficulty-display" aria-live="polite">LÃ¤dt...</div>
            </div>

            <!-- ? P1 DSGVO: Categories with FSK Badges -->
            <div class="setting-row">
                <div class="setting-header">Kategorien</div>
                <div class="categories-tags" id="selected-categories-display" role="list" aria-live="polite">
                    <span class="loading-text-muted">LÃ¤dt...</span>
                </div>
            </div>

            <button class="edit-settings-btn host-only"
                    id="edit-settings-btn"
                    type="button"
                    aria-label="Spieleinstellungen bearbeiten">
                âš™ï¸ Einstellungen Ã¤ndern
            </button>
        </aside>

        <!-- Players Section -->
        <section class="players-section">
            <div class="players-header">
                <h2 class="players-title">ğŸ‘¥ Spieler</h2>
                <div class="player-count" id="player-count" aria-live="polite">0/8 Spieler</div>
            </div>
            <div class="players-list" id="players-list" role="list">
                <div class="empty-players">Lade Spieler...</div>
            </div>
        </section>

        <!-- Join Info -->
        <aside class="join-info host-only">
            <div class="join-title">ğŸ“² Andere einladen</div>
            <div class="join-description">
                Teile den Spielcode oder QR-Code mit deinen Freunden, damit sie direkt beitreten kÃ¶nnen.
            </div>
        </aside>

        <!-- Controls -->
        <div class="controls" role="group" aria-label="Lobby-Steuerung">
            <button class="btn-ready guest-only"
                    id="ready-btn"
                    type="button"
                    aria-label="Als bereit markieren">
                <span aria-hidden="true">âœ…</span> Bereit
            </button>
            <button class="btn-start host-only"
                    id="start-btn"
                    type="button"
                    disabled
                    aria-disabled="true"
                    aria-label="Spiel starten (erst wenn alle bereit sind)">
                <span aria-hidden="true">ğŸ®</span> Spiel starten
            </button>
            <button class="btn-leave"
                    id="leave-btn"
                    type="button"
                    aria-label="Lobby verlassen">
                <span aria-hidden="true"></span> Lobby verlassen
            </button>
        </div>
    </div>
</div>

<!-- ? P1 STABILITY: Leave Confirmation Dialog for Host -->
<div class="confirmation-dialog"
     id="leave-confirmation"
     role="alertdialog"
     aria-modal="true"
     aria-labelledby="leave-dialog-title"
     aria-describedby="leave-dialog-desc"
     aria-hidden="true"
     hidden>
    <div class="dialog-overlay" aria-hidden="true"></div>
    <div class="dialog-content">
        <h2 id="leave-dialog-title" class="dialog-title">
            <span aria-hidden="true">ğŸšª</span> Lobby verlassen?
        </h2>
        <p id="leave-dialog-desc" class="dialog-description">
            <span id="leave-message-host" class="host-only">
                <strong>Als Host verlassen:</strong><br>
                <span id="connected-players-count">0 Spieler</span> sind verbunden.
                Wenn du die Lobby verlÃ¤sst, wird das Spiel fÃ¼r alle beendet.
            </span>
            <span id="leave-message-guest" class="guest-only">
                MÃ¶chtest du die Lobby wirklich verlassen?
            </span>
        </p>
        <div class="dialog-buttons" role="group" aria-label="BestÃ¤tigungsoptionen">
            <button class="btn-cancel"
                    id="cancel-leave-btn"
                    type="button"
                    aria-label="In der Lobby bleiben">
                Abbrechen
            </button>
            <button class="btn-confirm"
                    id="confirm-leave-btn"
                    type="button"
                    aria-label="Lobby jetzt verlassen">
                Verlassen
            </button>
        </div>
    </div>
</div>

<!-- Privacy Footer -->
<div class="privacy-footer">
    <a href="privacy.html"
       class="privacy-link"
       target="_blank"
       rel="noopener noreferrer"
       aria-label="DatenschutzerklÃ¤rung Ã¶ffnen">
        Datenschutz
    </a>
    <span class="footer-separator" aria-hidden="true">â€¢</span>
    <a href="imprint.html"
       class="privacy-link"
       target="_blank"
       rel="noopener noreferrer"
       aria-label="Impressum Ã¶ffnen">
        Impressum
    </a>
</div>
    <!-- âœ… ERROR BOUNDARY: Global Error Handling -->
    <script src="/assets/js/error-boundary.js"></script>

</body>
</html>
