{
  "rules": {
    ".read": false,
    ".write": false,

    "games": {
      "$gameId": {
        ".read": "auth != null && (
          data.child('players').child(auth.uid).exists() ||
          data.child('hostId').val() === auth.uid
        )",

        ".write": "auth != null && (
          !data.exists() ||
          data.child('hostId').val() === auth.uid
        )",

        "hostId": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },

        "gameCode": {
          ".validate": "newData.isString() && newData.val().matches(/^[A-Z0-9]{6}$/)"
        },

        "phase": {
          ".write": "auth != null && root.child('games').child($gameId).child('hostId').val() === auth.uid",
          ".validate": "newData.isString() && (
            newData.val() === 'lobby' ||
            newData.val() === 'playing' ||
            newData.val() === 'results' ||
            newData.val() === 'finished'
          )"
        },

        "currentQuestionIndex": {
          ".write": "auth != null && root.child('games').child($gameId).child('hostId').val() === auth.uid",
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },

        "scores": {
          ".write": "auth != null && root.child('games').child($gameId).child('hostId').val() === auth.uid"
        },

        "difficulty": {
          ".validate": "newData.isString() && (
            newData.val() === 'easy' ||
            newData.val() === 'medium' ||
            newData.val() === 'hard'
          )"
        },

        "alcoholMode": {
          ".validate": "newData.isBoolean()"
        },

        "selectedCategories": {
          ".validate": "newData.hasChildren()",
          "$category": {
            ".validate": "newData.isString() && (
              newData.val() === 'fsk0' ||
              newData.val() === 'fsk16' ||
              newData.val() === 'fsk18' ||
              newData.val() === 'special'
            )"
          }
        },

        "players": {
          "$playerId": {
            ".write": "auth != null && (
              $playerId === auth.uid ||
              root.child('games').child($gameId).child('hostId').val() === auth.uid
            )",

            "name": {
              ".validate": "newData.isString() && newData.val().length >= 2 && newData.val().length <= 15"
            },

            "isPremium": {
              ".write": "auth != null && $playerId === auth.uid",
              ".validate": "newData.isBoolean()"
            },

            "isHost": {
              ".validate": "newData.isBoolean()"
            },

            "isReady": {
              ".validate": "newData.isBoolean()"
            },

            "joinedAt": {
              ".validate": "newData.isNumber()"
            }
          }
        },

        "createdAt": {
          ".validate": "newData.isNumber()"
        },

        "lastActivity": {
          ".validate": "newData.isNumber()"
        },

        "ttl": {
          ".validate": "newData.isNumber()"
        }
      }
    },

    "questions": {
      ".read": "auth != null",
      ".write": false,

      "$category": {
        ".validate": "$category === 'fsk0' || $category === 'fsk16' || $category === 'fsk18' || $category === 'special'"
      }
    },

    "users": {
      "$userId": {
        ".read": "auth != null && auth.uid === $userId",
        ".write": "auth != null && auth.uid === $userId",

        "isPremium": {
          ".validate": "newData.isBoolean()"
        },

        "ageVerified": {
          ".validate": "newData.isBoolean()"
        },

        "ageLevel": {
          ".validate": "newData.isNumber() && (newData.val() === 0 || newData.val() === 16 || newData.val() === 18)"
        },

        "createdAt": {
          ".validate": "newData.isNumber()"
        },

        "lastLogin": {
          ".validate": "newData.isNumber()"
        }
      }
    }
  }
}

