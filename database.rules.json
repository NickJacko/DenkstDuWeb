{
  "rules": {
    ".read": false,
    ".write": false,

    "games": {
      "$gameId": {
        ".read": "auth != null",

        // ✅ FIX: Erlaubt allen authentifizierten Usern zu schreiben (für Join)
        ".write": "auth != null",

        "gameId": {
          ".validate": "newData.isString() && newData.val().length === 6 && newData.val().matches(/^[A-Z0-9]{6}$/)"
        },

        "hostId": {
          ".validate": "newData.isString()"
        },

        "hostName": {
          ".validate": "newData.isString()"
        },

        "status": {
          ".validate": "newData.isString() && (
            newData.val() == 'lobby' ||
            newData.val() == 'waiting' ||
            newData.val() == 'playing' ||
            newData.val() == 'finished'
          )"
        },

        "gameState": {
          ".validate": "newData.isString() && (
            newData.val() == 'waiting' ||
            newData.val() == 'playing' ||
            newData.val() == 'finished'
          )"
        },

        "createdAt": {
          ".validate": "newData.isNumber()"
        },

        "lastActivity": {
          ".validate": "newData.isNumber()"
        },

        "lastUpdate": {
          ".validate": "newData.isNumber()"
        },

        "players": {
          "$playerId": {
            ".read": "auth != null",
            // ✅ FIX: Erlaubt allen authentifizierten Usern Spieler hinzuzufügen/ändern
            ".write": "auth != null",

            "id": {
              ".validate": "newData.isString()"
            },

            "name": {
              ".validate": "newData.isString()"
            },

            "isHost": {
              ".validate": "newData.isBoolean()"
            },

            "isReady": {
              ".validate": "newData.isBoolean()"
            },

            "joinedAt": {
              ".validate": "newData.isNumber()"
            }
          }
        },

        "settings": {
          // ✅ FIX: Erlaubt allen authentifizierten Usern Settings zu lesen/schreiben
          ".write": "auth != null",

          "categories": {
            ".validate": "newData.val() != null"
          },

          "difficulty": {
            ".validate": "newData.isString() && (newData.val() == 'easy' || newData.val() == 'medium' || newData.val() == 'hard')"
          },

          "alcoholMode": {
            ".validate": "newData.isBoolean()"
          },


          "mode": {
            ".validate": "newData.isString()"
          }
        },

        "currentQuestion": {
          ".read": "auth != null",
          ".write": "auth != null"
        },

        "currentRound": {
          ".validate": "newData.isNumber()"
        },

        "rounds": {
          "$roundId": {
            ".read": "auth != null",
            ".write": "auth != null",

            "question": {
              ".validate": "newData.val() != null"
            },

            "answers": {
              "$playerId": {
                ".read": "auth != null",
                ".write": "auth != null"
              }
            },

            "startedAt": {
              ".validate": "newData.isNumber()"
            }
          }
        },

        "answers": {
          "$playerId": {
            ".read": "auth != null",
            ".write": "auth != null"
          }
        },

        "scores": {
          ".read": "auth != null",
          ".write": "auth != null"
        },

        "showOverallResults": {
          ".validate": "newData.isBoolean()"
        },

        "overallStats": {
          ".read": "auth != null",
          ".write": "auth != null"
        },

        "startedAt": {
          ".validate": "newData.isNumber()"
        }
      }
    },

    "users": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId",
        ".write": "auth != null && auth.uid == $userId",


        "displayName": {
          ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 30"
        },

        "ageVerified": {
          ".validate": "newData.isBoolean()"
        },

        "ageVerificationLevel": {
          ".validate": "newData.isNumber() && (newData.val() == 0 || newData.val() == 18)"
        },

        "stats": {
          ".read": "auth != null",
          ".write": "auth != null && auth.uid == $userId"
        }
      }
    },

    "audit_logs": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId",
        ".write": false
      }
    },

    "leaderboard": {
      ".read": "auth != null",
      ".write": false,
      ".indexOn": ["score", "timestamp"]
    },

    "questions": {
      ".read": "auth != null",
      ".write": false,

      "fsk0": {
        ".read": "auth != null",
        ".indexOn": ["category", "difficulty"]
      },
      "fsk16": {
        ".read": "auth != null",
        ".indexOn": ["category", "difficulty"]
      },
      "fsk18": {
        ".read": "auth != null",
        ".indexOn": ["category", "difficulty"]
      },
      "special": {
        ".read": "auth != null",
        ".indexOn": ["category", "difficulty"]
      }
    }
  }
}

