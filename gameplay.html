<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>DenkstDu - Spielen</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Background Particles -->
    <div class="background-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- App Container -->
    <div class="app-container">
        
        <!-- SCHRITT 1: Frage zeigen -->
        <div class="screen active" id="question-screen">
            <div class="content-area">
                <!-- Header -->
                <div class="game-header">
                    <div class="round-info">Runde <span id="round-number">1</span> / 10</div>
                    <div class="category-info" id="category-name">üéâ Party Time</div>
                    <button class="menu-btn" onclick="showMenu()">‚ãÆ</button>
                </div>

                <!-- Frage Card -->
                <div class="question-card">
                    <h1 class="question-title">Ich habe noch nie...</h1>
                    <div class="question-text" id="question-text">...nackt gebadet.</div>
                </div>

                <!-- Erkl√§rung -->
                <div class="instruction-card">
                    <h3>üìã So geht's:</h3>
                    <div class="steps">
                        <div class="step">1. Jeder denkt: <strong>Habe ICH das schon mal gemacht?</strong></div>
                        <div class="step">2. Alle stimmen geheim ab</div>
                        <div class="step">3. Alle sch√§tzen die Anzahl der "Ja"-Stimmen</div>
                        <div class="step">4. Aufl√∂sung + wer trinken muss!</div>
                    </div>
                </div>

                <!-- Start Button -->
                <button class="btn-primary btn-large" onclick="startVoting()">
                    Alle bereit? Abstimmung starten! üó≥Ô∏è
                </button>
            </div>
        </div>

        <!-- SCHRITT 2: Abstimmung -->
        <div class="screen" id="voting-screen">
            <div class="content-area">
                <!-- Header -->
                <div class="game-header">
                    <div class="round-info">Runde <span class="round-number">1</span> / 10</div>
                    <div class="phase-info">Abstimmung</div>
                    <button class="menu-btn" onclick="showMenu()">‚ãÆ</button>
                </div>

                <!-- Aktueller Spieler -->
                <div class="player-card">
                    <div class="player-avatar" id="voter-avatar">M</div>
                    <div class="player-details">
                        <div class="player-name" id="voter-name">Max</div>
                        <div class="player-status">Du bist dran! <span id="voting-progress">(1/4)</span></div>
                    </div>
                </div>

                <!-- Frage erinnern -->
                <div class="question-reminder">
                    <div class="reminder-label">Ich habe noch nie...</div>
                    <div class="reminder-question" id="voting-question">nackt gebadet</div>
                    <div class="reminder-ask"><strong>Hast DU das schon mal gemacht?</strong></div>
                </div>

                <!-- Abstimm-Buttons -->
                <div class="voting-buttons">
                    <button class="vote-btn vote-yes" onclick="vote(true)">
                        <div class="vote-emoji">‚úÖ</div>
                        <div class="vote-text">JA</div>
                        <div class="vote-subtext">Hab ich gemacht</div>
                    </button>
                    <button class="vote-btn vote-no" onclick="vote(false)">
                        <div class="vote-emoji">‚ùå</div>
                        <div class="vote-text">NEIN</div>
                        <div class="vote-subtext">Hab ich nie gemacht</div>
                    </button>
                </div>
            </div>
        </div>

        <!-- SCHRITT 3: Sch√§tzen -->
        <div class="screen" id="estimation-screen">
            <div class="content-area">
                <!-- Header -->
                <div class="game-header">
                    <div class="round-info">Runde <span class="round-number">1</span> / 10</div>
                    <div class="phase-info">Sch√§tzen</div>
                    <button class="menu-btn" onclick="showMenu()">‚ãÆ</button>
                </div>

                <!-- Aktueller Spieler -->
                <div class="player-card">
                    <div class="player-avatar" id="estimator-avatar">M</div>
                    <div class="player-details">
                        <div class="player-name" id="estimator-name">Max</div>
                        <div class="player-status">Deine Sch√§tzung! <span id="estimation-progress">(1/4)</span></div>
                    </div>
                </div>

                <!-- Frage erinnern -->
                <div class="question-reminder">
                    <div class="reminder-label">Ich habe noch nie...</div>
                    <div class="reminder-question" id="estimation-question">nackt gebadet</div>
                </div>

                <!-- Sch√§tz-Interface -->
                <div class="estimation-card">
                    <div class="estimation-question">
                        Wie viele haben <strong>"JA"</strong> gesagt?
                    </div>
                    
                    <!-- Zahl-Picker -->
                    <div class="number-picker">
                        <button class="picker-btn" onclick="changeEstimate(-1)" id="minus-btn">‚àí</button>
                        <div class="estimate-display">
                            <div class="estimate-number" id="estimate">2</div>
                            <div class="estimate-label">von <span id="total-players">4</span></div>
                        </div>
                        <button class="picker-btn" onclick="changeEstimate(1)" id="plus-btn">+</button>
                    </div>

                    <!-- Schnell-Buttons -->
                    <div class="quick-picks" id="quick-picks">
                        <!-- Dynamisch generiert -->
                    </div>

                    <!-- Best√§tigen -->
                    <button class="btn-primary" onclick="confirmEstimate()" id="confirm-estimate-btn">
                        Sch√§tzung best√§tigen
                    </button>
                </div>
            </div>
        </div>

        <!-- SCHRITT 4: Ergebnisse -->
        <div class="screen" id="results-screen">
            <div class="content-area">
                <!-- Header -->
                <div class="game-header">
                    <div class="round-info">Runde <span class="round-number">1</span> / 10</div>
                    <div class="phase-info">Aufl√∂sung</div>
                    <button class="menu-btn" onclick="showMenu()">‚ãÆ</button>
                </div>

                <!-- Frage erinnern -->
                <div class="question-reminder">
                    <div class="reminder-label">Ich habe noch nie...</div>
                    <div class="reminder-question" id="results-question">nackt gebadet</div>
                </div>

                <!-- Hauptergebnis -->
                <div class="result-main">
                    <div class="result-icon">üéØ</div>
                    <div class="result-text">
                        <div class="result-number" id="actual-count">2</div>
                        <div class="result-label">haben "JA" gesagt!</div>
                    </div>
                </div>

                <!-- Wer hat Ja gesagt -->
                <div class="yes-voters-section" id="yes-voters-section">
                    <h3>üëÄ Die haben's zugegeben:</h3>
                    <div class="yes-voters" id="yes-voters">
                        <!-- Dynamisch gef√ºllt -->
                    </div>
                </div>

                <!-- Sch√§tzungen & Strafen -->
                <div class="results-section">
                    <h3>üîÆ Sch√§tzungen & Strafen:</h3>
                    <div class="results-list" id="results-list">
                        <!-- Dynamisch gef√ºllt -->
                    </div>
                </div>

                <!-- Weiter Button -->
                <button class="btn-primary btn-large" onclick="nextRound()" id="next-round-btn">
                    N√§chste Runde! üéâ
                </button>
            </div>
        </div>

        <!-- SCHRITT 5: Spiel Ende -->
        <div class="screen" id="end-screen">
            <div class="content-area">
                <div class="end-header">
                    <h1>üèÜ Spiel beendet!</h1>
                    <p>Das waren alle 10 Runden!</p>
                </div>

                <!-- Endergebnisse -->
                <div class="final-results">
                    <h3>ü•á Endrangliste</h3>
                    <div class="rankings" id="final-rankings">
                        <!-- Dynamisch gef√ºllt -->
                    </div>
                </div>

                <!-- Statistiken -->
                <div class="final-stats">
                    <h3>üìä Statistiken</h3>
                    <div class="stats-grid" id="final-stats-grid">
                        <!-- Dynamisch gef√ºllt -->
                    </div>
                </div>

                <!-- Aktionen -->
                <div class="end-actions">
                    <button class="btn-primary btn-large" onclick="playAgain()">
                        üîÑ Nochmal spielen
                    </button>
                    <button class="btn-secondary" onclick="goHome()">
                        üè† Hauptmen√º
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Men√º Modal -->
    <div class="modal" id="menu-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üéÆ Spielmen√º</h3>
                <button class="close-btn" onclick="closeMenu()">‚úï</button>
            </div>
            <div class="modal-body">
                <button class="menu-option" onclick="resumeGame()">
                    ‚ñ∂Ô∏è Weiterspielen
                </button>
                <button class="menu-option" onclick="restartGame()">
                    üîÑ Spiel neustarten
                </button>
                <button class="menu-option" onclick="goHome()">
                    üè† Hauptmen√º
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
        }

        /* Background */
        .background-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        .particle:nth-child(1) { width: 60px; height: 60px; left: 10%; animation-delay: 0s; }
        .particle:nth-child(2) { width: 100px; height: 100px; left: 70%; animation-delay: 1s; }
        .particle:nth-child(3) { width: 40px; height: 40px; left: 30%; animation-delay: 2s; }
        .particle:nth-child(4) { width: 80px; height: 80px; left: 80%; animation-delay: 3s; }
        .particle:nth-child(5) { width: 30px; height: 30px; left: 50%; animation-delay: 4s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
            25% { transform: translateY(-20px) rotate(90deg); opacity: 0.6; }
            50% { transform: translateY(0px) rotate(180deg); opacity: 0.3; }
            75% { transform: translateY(-10px) rotate(270deg); opacity: 0.6; }
        }

        /* Layout */
        .app-container {
            min-height: 100vh;
            padding: 20px;
        }

        .screen {
            display: none;
            min-height: 100vh;
            animation: slideIn 0.5s ease-out;
        }

        .screen.active {
            display: block;
        }

        .content-area {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
        }

        /* Header */
        .game-header {
            width: 100%;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .round-info, .category-info, .phase-info {
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .category-info, .phase-info {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .menu-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .menu-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* Cards */
        .question-card, .instruction-card, .player-card, .question-reminder, .estimation-card, .result-main, .final-results, .final-stats {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 30px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        /* Question Card */
        .question-title {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .question-text {
            color: white;
            font-size: 2.5rem;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Instruction Card */
        .instruction-card h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .steps {
            display: flex;
            flex-direction: column;
            gap: 12px;
            text-align: left;
        }

        .step {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
            border-left: 4px solid #4CAF50;
        }

        /* Player Card */
        .player-card {
            display: flex;
            align-items: center;
            gap: 20px;
            text-align: left;
            padding: 25px;
        }

        .player-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #4CAF50, #81C784);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
            flex-shrink: 0;
        }

        .player-name {
            color: white;
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .player-status {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
        }

        /* Question Reminder */
        .reminder-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .reminder-question {
            color: white;
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 15px;
        }

        .reminder-ask {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Voting Buttons */
        .voting-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
        }

        .vote-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 35px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .vote-btn:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.2);
        }

        .vote-yes:hover {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
        }

        .vote-no:hover {
            border-color: #F44336;
            background: rgba(244, 67, 54, 0.2);
        }

        .vote-emoji {
            font-size: 3rem;
        }

        .vote-text {
            color: white;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .vote-subtext {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
        }

        /* Estimation */
        .estimation-question {
            color: white;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 30px;
        }

        .number-picker {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin-bottom: 25px;
        }

        .picker-btn {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            font-size: 2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .picker-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .picker-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .estimate-display {
            text-align: center;
        }

        .estimate-number {
            color: white;
            font-size: 4rem;
            font-weight: 800;
            line-height: 1;
        }

        .estimate-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.2rem;
            margin-top: 5px;
        }

        .quick-picks {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 25px;
        }

        .quick-pick {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .quick-pick:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .quick-pick.selected {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }

        /* Results */
        .result-main {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px;
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid rgba(76, 175, 80, 0.4);
        }

        .result-icon {
            font-size: 3rem;
        }

        .result-number {
            color: #4CAF50;
            font-size: 4rem;
            font-weight: 800;
            line-height: 1;
        }

        .result-label {
            color: white;
            font-size: 1.3rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .yes-voters-section h3, .results-section h3 {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .yes-voters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .yes-voter {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.4);
            color: #4CAF50;
            padding: 8px 16px;
            border-radius: 15px;
            font-weight: 600;
        }

        .results-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 20px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-player {
            color: white;
            font-weight: 600;
        }

        .result-details {
            text-align: right;
        }

        .result-estimate {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
        }

        .result-penalty {
            color: #FF9800;
            font-weight: 700;
            margin-top: 3px;
        }

        .penalty-perfect {
            color: #4CAF50;
        }

        .penalty-close {
            color: #FFC107;
        }

        .penalty-bad {
            color: #F44336;
        }

        /* End Screen */
        .end-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .end-header h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 15px;
        }

        .end-header p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.2rem;
        }

        .final-results h3, .final-stats h3 {
            color: white;
            font-size: 1.5rem;
            margin-bottom: 25px;
        }

        .rankings {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ranking-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            border-left: 5px solid #4CAF50;
        }

        .ranking-item:first-child {
            border-left-color: #FFD700;
            background: rgba(255, 215, 0, 0.1);
        }

        .ranking-position {
            font-size: 1.8rem;
            font-weight: 800;
            color: #4CAF50;
            min-width: 40px;
        }

        .ranking-item:first-child .ranking-position {
            color: #FFD700;
        }

        .ranking-player {
            flex: 1;
        }

        .ranking-name {
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .ranking-stats {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            color: #4CAF50;
            font-size: 2rem;
            font-weight: 800;
            display: block;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Buttons */
        .btn-primary, .btn-secondary {
            background: linear-gradient(45deg, #4CAF50, #81C784);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-large {
            padding: 20px 40px;
            font-size: 1.3rem;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.4);
            color: rgba(255, 255, 255, 0.9);
            box-shadow: none;
        }

        .btn-primary:hover, .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
        }

        .end-actions {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            max-width: 350px;
            width: 90%;
            overflow: hidden;
        }

        .modal-header {
            background: rgba(76, 175, 80, 0.1);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .modal-header h3 {
            color: #333;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 5px;
        }

        .modal-body {
            padding: 20px;
        }

        .menu-option {
            width: 100%;
            background: transparent;
            border: 2px solid #ddd;
            color: #333;
            padding: 15px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .menu-option:hover {
            background: #f0f0f0;
            border-color: #4CAF50;
        }

        /* Loading */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading.show {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
        }

        .toast {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            animation: slideInRight 0.3s ease-out;
            max-width: 300px;
        }

        .toast.success { border-left-color: #4CAF50; }
        .toast.warning { border-left-color: #FFC107; }
        .toast.error { border-left-color: #F44336; }

        .toast-text {
            color: #333;
            font-size: 0.9rem;
            font-weight: 500;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Mobile */
        @media (max-width: 768px) {
            .app-container {
                padding: 15px;
            }

            .content-area {
                gap: 20px;
            }

            .question-text {
                font-size: 2rem;
            }

            .reminder-question {
                font-size: 1.5rem;
            }

            .voting-buttons {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .vote-btn {
                padding: 25px 20px;
            }

            .vote-text {
                font-size: 1.5rem;
            }

            .result-number, .estimate-number {
                font-size: 3rem;
            }

            .end-actions {
                flex-direction: column;
                align-items: center;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>

    <script>
        // Global Game State
        let gameState = null;
        let currentGame = {
            players: [],
            questions: [],
            currentRound: 1,
            totalRounds: 10,
            currentPlayerIndex: 0,
            currentScreen: 'question',
            votes: {},
            estimates: {},
            roundResults: [],
            settings: {}
        };

        // Questions Database
        const questionsDB = {
            fsk0: [
                "im Ausland gewesen",
                "ein Buch zu Ende gelesen",
                "auf einem Konzert gewesen",
                "einen Film zweimal hintereinander geschaut",
                "mich beim Kochen verletzt",
                "einen ganzen Tag im Pyjama verbracht",
                "mit √∂ffentlichen Verkehrsmitteln gefahren",
                "Karaoke gesungen",
                "eine Fremdsprache gelernt",
                "einen Regenbogen gesehen"
            ],
            fsk16: [
                "richtig betrunken gewesen",
                "gelogen, um frei zu bekommen",
                "heimlich verliebt gewesen",
                "beim Mogeln erwischt worden",
                "einen peinlichen Moment vor anderen gehabt",
                "auf einer Party gekotzt",
                "bei den Eltern gelogen",
                "eine Mutprobe gemacht",
                "bei einer Klassenarbeit geschummelt",
                "heimlich geraucht"
            ],
            fsk18: [
                "einen One-Night-Stand gehabt",
                "etwas Illegales gemacht",
                "fremdgegangen",
                "nackt gebadet",
                "in der √ñffentlichkeit geknutscht",
                "√ºber mein Liebesleben gelogen",
                "etwas gestohlen",
                "mich betrunken an nichts mehr erinnert",
                "Nacktbilder verschickt",
                "beim Fremdgehen erwischt worden"
            ]
        };

        // Game State Management
        class GameState {
            constructor() {
                this.loadFromStorage();
            }

            loadFromStorage() {
                try {
                    const saved = localStorage.getItem('denkstdu_game_state');
                    if (saved) {
                        const state = JSON.parse(saved);
                        if (state.timestamp && Date.now() - state.timestamp < 24 * 60 * 60 * 1000) {
                            Object.assign(this, state);
                            return true;
                        }
                    }
                } catch (error) {
                    console.error('Could not load game state:', error);
                }
                return false;
            }
        }

        // Initialize Game
        function initGame() {
            console.log('üéÆ Initializing DenkstDu Gameplay...');
            
            gameState = new GameState();
            
            // Validate game state
            if (!gameState.players || gameState.players.length < 2) {
                showToast('Keine Spieler gefunden!', 'error');
                setTimeout(() => window.location.href = 'player-setup.html', 2000);
                return;
            }

            if (!gameState.selectedCategories || gameState.selectedCategories.length === 0) {
                showToast('Keine Kategorien ausgew√§hlt!', 'error');
                setTimeout(() => window.location.href = 'category-selection.html', 2000);
                return;
            }

            // Setup game
            currentGame.players = [...gameState.players];
            currentGame.questions = generateQuestions();
            currentGame.settings = {
                categories: gameState.selectedCategories,
                difficulty: gameState.difficulty,
                baseSips: getBaseSips()
            };

            // Initialize UI
            updateGameUI();
            showCurrentQuestion();
            
            console.log('‚úÖ Game initialized:', currentGame);
        }

        // Generate Questions
        function generateQuestions() {
            let allQuestions = [];
            
            gameState.selectedCategories.forEach(category => {
                if (questionsDB[category]) {
                    questionsDB[category].forEach(q => {
                        allQuestions.push({
                            text: q,
                            category: category
                        });
                    });
                }
            });
            
            // Shuffle and take 10
            return shuffleArray(allQuestions).slice(0, currentGame.totalRounds);
        }

        // Get Base Sips from Difficulty
        function getBaseSips() {
            const sips = { easy: 1, medium: 2, hard: 3 };
            return sips[gameState.difficulty] || 2;
        }

        // Update Game UI
        function updateGameUI() {
            // Update round numbers
            document.querySelectorAll('#round-number, .round-number').forEach(el => {
                el.textContent = currentGame.currentRound;
            });

            // Update category
            const categoryNames = {
                fsk0: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie & Freunde',
                fsk16: 'üéâ Party Time', 
                fsk18: 'üî• Hei√ü & Gewagt'
            };
            
            if (currentGame.questions[currentGame.currentRound - 1]) {
                const currentCategory = currentGame.questions[currentGame.currentRound - 1].category;
                document.getElementById('category-name').textContent = categoryNames[currentCategory];
            }

            // Update total players
            document.querySelectorAll('#total-players, .total-players').forEach(el => {
                el.textContent = currentGame.players.length;
            });
        }

        // Show Current Question
        function showCurrentQuestion() {
            if (currentGame.currentRound > currentGame.questions.length) {
                endGame();
                return;
            }

            const question = currentGame.questions[currentGame.currentRound - 1];
            
            // Update question text
            document.getElementById('question-text').textContent = `...${question.text}.`;
            
            // Show question screen
            showScreen('question-screen');
        }

        // Start Voting Phase
        function startVoting() {
            currentGame.currentPlayerIndex = 0;
            currentGame.votes = {};
            
            showScreen('voting-screen');
            updateVotingUI();
        }

        // Update Voting UI
        function updateVotingUI() {
            const currentPlayer = currentGame.players[currentGame.currentPlayerIndex];
            const question = currentGame.questions[currentGame.currentRound - 1];
            
            // Update player info
            document.getElementById('voter-avatar').textContent = currentPlayer.charAt(0).toUpperCase();
            document.getElementById('voter-name').textContent = currentPlayer;
            document.getElementById('voting-progress').textContent = `(${currentGame.currentPlayerIndex + 1}/${currentGame.players.length})`;
            
            // Update question
            document.getElementById('voting-question').textContent = question.text;
        }

        // Submit Vote
        function vote(answer) {
            const currentPlayer = currentGame.players[currentGame.currentPlayerIndex];
            currentGame.votes[currentPlayer] = answer;
            
            showToast(`${currentPlayer}: ${answer ? 'JA' : 'NEIN'}`, 'success', 2000);
            
            // Move to next player or estimation
            setTimeout(() => {
                if (currentGame.currentPlayerIndex < currentGame.players.length - 1) {
                    currentGame.currentPlayerIndex++;
                    updateVotingUI();
                } else {
                    startEstimation();
                }
            }, 1500);
        }

        // Start Estimation Phase
        function startEstimation() {
            currentGame.currentPlayerIndex = 0;
            currentGame.estimates = {};
            
            showScreen('estimation-screen');
            updateEstimationUI();
        }

        // Update Estimation UI
        function updateEstimationUI() {
            const currentPlayer = currentGame.players[currentGame.currentPlayerIndex];
            const question = currentGame.questions[currentGame.currentRound - 1];
            
            // Update player info
            document.getElementById('estimator-avatar').textContent = currentPlayer.charAt(0).toUpperCase();
            document.getElementById('estimator-name').textContent = currentPlayer;
            document.getElementById('estimation-progress').textContent = `(${currentGame.currentPlayerIndex + 1}/${currentGame.players.length})`;
            
            // Update question
            document.getElementById('estimation-question').textContent = question.text;
            
            // Reset estimate
            document.getElementById('estimate').textContent = Math.floor(currentGame.players.length / 2);
            
            // Generate quick picks
            generateQuickPicks();
            updateEstimateButtons();
        }

        // Generate Quick Pick Buttons
        function generateQuickPicks() {
            const container = document.getElementById('quick-picks');
            container.innerHTML = '';
            
            for (let i = 0; i <= currentGame.players.length; i++) {
                const btn = document.createElement('button');
                btn.className = 'quick-pick';
                btn.textContent = i;
                btn.onclick = () => setEstimate(i);
                container.appendChild(btn);
            }
        }

        // Change Estimate
        function changeEstimate(delta) {
            const current = parseInt(document.getElementById('estimate').textContent);
            const newValue = Math.max(0, Math.min(currentGame.players.length, current + delta));
            setEstimate(newValue);
        }

        // Set Estimate
        function setEstimate(value) {
            document.getElementById('estimate').textContent = value;
            updateEstimateButtons();
            
            // Update quick pick selection
            document.querySelectorAll('.quick-pick').forEach(btn => {
                btn.classList.toggle('selected', parseInt(btn.textContent) === value);
            });
        }

        // Update Estimate Buttons
        function updateEstimateButtons() {
            const current = parseInt(document.getElementById('estimate').textContent);
            document.getElementById('minus-btn').disabled = current <= 0;
            document.getElementById('plus-btn').disabled = current >= currentGame.players.length;
        }

        // Confirm Estimate
        function confirmEstimate() {
            const currentPlayer = currentGame.players[currentGame.currentPlayerIndex];
            const estimate = parseInt(document.getElementById('estimate').textContent);
            
            currentGame.estimates[currentPlayer] = estimate;
            
            showToast(`${currentPlayer} sch√§tzt: ${estimate}`, 'success', 2000);
            
            // Move to next player or results
            setTimeout(() => {
                if (currentGame.currentPlayerIndex < currentGame.players.length - 1) {
                    currentGame.currentPlayerIndex++;
                    updateEstimationUI();
                } else {
                    showResults();
                }
            }, 1500);
        }

        // Show Results
        function showResults() {
            const question = currentGame.questions[currentGame.currentRound - 1];
            
            // Calculate actual yes count
            const actualYes = Object.values(currentGame.votes).filter(vote => vote).length;
            
            // Update question
            document.getElementById('results-question').textContent = question.text;
            
            // Update actual count
            document.getElementById('actual-count').textContent = actualYes;
            
            // Show who voted yes
            displayYesVoters(actualYes);
            
            // Show results and penalties
            displayResults(actualYes);
            
            // Save round result
            saveRoundResult(actualYes);
            
            // Update next round button
            const nextBtn = document.getElementById('next-round-btn');
            if (currentGame.currentRound >= currentGame.totalRounds) {
                nextBtn.textContent = 'Endergebnisse anzeigen! üèÜ';
            }
            
            showScreen('results-screen');
        }

        // Display Yes Voters
        function displayYesVoters(actualYes) {
            const container = document.getElementById('yes-voters');
            const section = document.getElementById('yes-voters-section');
            
            if (actualYes === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            
            const yesVoters = currentGame.players.filter(player => 
                currentGame.votes[player] === true
            );
            
            container.innerHTML = yesVoters.map(player => 
                `<div class="yes-voter">${player}</div>`
            ).join('');
        }

        // Display Results and Penalties
        function displayResults(actualYes) {
            const container = document.getElementById('results-list');
            const baseSips = currentGame.settings.baseSips;
            
            container.innerHTML = currentGame.players.map(player => {
                const estimate = currentGame.estimates[player];
                const difference = Math.abs(estimate - actualYes);
                
                let penalty = '';
                let penaltyClass = '';
                
                if (difference === 0) {
                    penalty = 'Perfekt! 0 Schl√ºcke üéØ';
                    penaltyClass = 'penalty-perfect';
                } else {
                    const totalSips = baseSips + difference;
                    penalty = `${totalSips} Schl√ºcke üç∫`;
                    
                    if (difference === 1) {
                        penaltyClass = 'penalty-close';
                    } else {
                        penaltyClass = 'penalty-bad';
                    }
                }
                
                return `
                    <div class="result-item">
                        <div class="result-player">${player}</div>
                        <div class="result-details">
                            <div class="result-estimate">Sch√§tzung: ${estimate}</div>
                            <div class="result-penalty ${penaltyClass}">${penalty}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Save Round Result
        function saveRoundResult(actualYes) {
            currentGame.roundResults.push({
                round: currentGame.currentRound,
                question: currentGame.questions[currentGame.currentRound - 1],
                actualYes: actualYes,
                votes: { ...currentGame.votes },
                estimates: { ...currentGame.estimates }
            });
        }

        // Next Round
        function nextRound() {
            if (currentGame.currentRound >= currentGame.totalRounds) {
                endGame();
                return;
            }
            
            currentGame.currentRound++;
            currentGame.votes = {};
            currentGame.estimates = {};
            currentGame.currentPlayerIndex = 0;
            
            updateGameUI();
            showCurrentQuestion();
        }

        // End Game
        function endGame() {
            displayFinalResults();
            showScreen('end-screen');
        }

        // Display Final Results
        function displayFinalResults() {
            const rankings = calculateFinalRankings();
            const stats = calculateGameStats();
            
            // Display rankings
            const rankingsContainer = document.getElementById('final-rankings');
            rankingsContainer.innerHTML = rankings.map((player, index) => `
                <div class="ranking-item">
                    <div class="ranking-position">${index + 1}</div>
                    <div class="ranking-player">
                        <div class="ranking-name">${player.name}</div>
                        <div class="ranking-stats">
                            ${player.totalSips} Schl√ºcke ‚Ä¢ ${player.perfectGuesses} Treffer
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Display stats
            const statsContainer = document.getElementById('final-stats-grid');
            statsContainer.innerHTML = `
                <div class="stat-item">
                    <span class="stat-value">${stats.totalQuestions}</span>
                    <span class="stat-label">Fragen gespielt</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${stats.totalYesAnswers}</span>
                    <span class="stat-label">Ja-Antworten</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${stats.mostHonestPlayer}</span>
                    <span class="stat-label">Ehrlichster Spieler</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${stats.bestGuesser}</span>
                    <span class="stat-label">Bester Sch√§tzer</span>
                </div>
            `;
        }

        // Calculate Final Rankings
        function calculateFinalRankings() {
            const baseSips = currentGame.settings.baseSips;
            
            const playerStats = currentGame.players.map(playerName => {
                let totalSips = 0;
                let perfectGuesses = 0;
                
                currentGame.roundResults.forEach(result => {
                    const estimate = result.estimates[playerName];
                    const actual = result.actualYes;
                    const difference = Math.abs(estimate - actual);
                    
                    if (difference === 0) {
                        perfectGuesses++;
                    } else {
                        totalSips += baseSips + difference;
                    }
                });
                
                return {
                    name: playerName,
                    totalSips: totalSips,
                    perfectGuesses: perfectGuesses
                };
            });
            
            // Sort by total sips (fewer is better)
            return playerStats.sort((a, b) => a.totalSips - b.totalSips);
        }

        // Calculate Game Stats
        function calculateGameStats() {
            const totalQuestions = currentGame.roundResults.length;
            const totalYesAnswers = currentGame.roundResults.reduce((sum, result) => sum + result.actualYes, 0);
            
            // Most honest player (most yes votes)
            const playerYesCounts = {};
            currentGame.players.forEach(player => {
                playerYesCounts[player] = currentGame.roundResults.reduce((count, result) => 
                    count + (result.votes[player] ? 1 : 0), 0);
            });
            
            const mostHonestPlayer = Object.keys(playerYesCounts).reduce((a, b) => 
                playerYesCounts[a] > playerYesCounts[b] ? a : b);
            
            // Best guesser (most perfect guesses)
            const perfectGuessCounts = {};
            currentGame.players.forEach(player => {
                perfectGuessCounts[player] = currentGame.roundResults.reduce((count, result) => 
                    count + (Math.abs(result.estimates[player] - result.actualYes) === 0 ? 1 : 0), 0);
            });
            
            const bestGuesser = Object.keys(perfectGuessCounts).reduce((a, b) => 
                perfectGuessCounts[a] > perfectGuessCounts[b] ? a : b);
            
            return {
                totalQuestions,
                totalYesAnswers,
                mostHonestPlayer,
                bestGuesser
            };
        }

        // Screen Management
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Menu Functions
        function showMenu() {
            document.getElementById('menu-modal').style.display = 'flex';
        }

        function closeMenu() {
            document.getElementById('menu-modal').style.display = 'none';
        }

        function resumeGame() {
            closeMenu();
        }

        function restartGame() {
            if (confirm('Spiel wirklich neu starten? Alle Fortschritte gehen verloren.')) {
                localStorage.removeItem('denkstdu_game_state');
                window.location.reload();
            }
        }

        function playAgain() {
            if (confirm('Nochmal spielen? Zur√ºck zur Spielerauswahl.')) {
                window.location.href = 'player-setup.html';
            }
        }

        function goHome() {
            if (confirm('Zur√ºck zum Hauptmen√º? Alle Fortschritte gehen verloren.')) {
                localStorage.removeItem('denkstdu_game_state');
                window.location.href = 'index.html';
            }
        }

        // Utility Functions
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function showToast(message, type = 'success', duration = 3000) {
            const container = document.getElementById('toast-container');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<div class="toast-text">${message}</div>`;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, duration);
        }

        function showLoading() {
            document.getElementById('loading').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('show');
        }

        // Initialize when DOM loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
            background: rgba(76, 175, 80, 0.1);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px