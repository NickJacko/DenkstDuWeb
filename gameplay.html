<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>DenkstDu - Spielen</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
            position: relative;
        }

        /* Background Particles */
        .background-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            animation: float 15s ease-in-out infinite;
        }

        .particle:nth-child(1) { width: 100px; height: 100px; left: 10%; animation-delay: 0s; }
        .particle:nth-child(2) { width: 60px; height: 60px; left: 80%; animation-delay: 3s; }
        .particle:nth-child(3) { width: 80px; height: 80px; left: 30%; animation-delay: 6s; }
        .particle:nth-child(4) { width: 120px; height: 120px; left: 70%; animation-delay: 9s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
            25% { transform: translateY(-30px) rotate(90deg); opacity: 0.6; }
            50% { transform: translateY(-60px) rotate(180deg); opacity: 0.3; }
            75% { transform: translateY(-30px) rotate(270deg); opacity: 0.6; }
        }

        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 10px;
            max-width: 450px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }



        /* Main Content Area - Flexibel */
        .game-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        /* Question Card - Kompakt */
        .question-card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            padding: 15px 20px;
            margin-bottom: 10px;
            text-align: center;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .question-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #4CAF50, #2196F3, #9C27B0);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 200% 0; }
            50% { background-position: -200% 0; }
        }

        .question-category {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.25), rgba(76, 175, 80, 0.35));
            border: 1px solid rgba(76, 175, 80, 0.5);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
            display: inline-block;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }

        .question-text {
            color: white;
            font-size: 1rem;
            font-weight: 700;
            line-height: 1.4;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Current Player Display - Kompakt */
        .current-player-card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: 15px;
            padding: 12px 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 1rem;
            box-shadow: 0 5px 20px rgba(79, 172, 254, 0.3);
            flex-shrink: 0;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            color: white;
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .player-status {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
        }

        /* Answer Section - Optimiert */
        .answer-section {
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .answer-title {
            color: white;
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .answer-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .answer-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.25);
            color: white;
            padding: 15px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .answer-btn:active {
            transform: scale(0.95);
        }

        .answer-btn.selected {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .answer-btn.yes.selected {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.4));
            border-color: #4CAF50;
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3);
        }

        .answer-btn.no.selected {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.3), rgba(244, 67, 54, 0.4));
            border-color: #f44336;
            box-shadow: 0 10px 30px rgba(244, 67, 54, 0.3);
        }

        .answer-emoji {
            font-size: 1.2rem;
        }

        /* Estimation Section - Verbessert */
        .estimation-section {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: 15px;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .estimation-title {
            color: white;
            font-size: 0.9rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }

        /* Number Grid - Verbessert */
        .number-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(55px, 1fr));
            gap: 12px;
            justify-items: center;
            flex: 1;
            align-content: center;
        }

        .number-btn {
            width: 55px;
            height: 55px;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 50%;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .number-btn:active {
            transform: scale(0.95);
        }

        .number-btn.selected {
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            border-color: #4CAF50;
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
            color: white;
        }

        /* Selected Number Display - Kompakt */
        .current-selection {
            text-align: center;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .selection-display {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.3));
            border: 2px solid rgba(76, 175, 80, 0.5);
            border-radius: 12px;
            padding: 8px 12px;
            display: inline-block;
            min-width: 100px;
        }

        .selection-number {
            color: white;
            font-size: 1.2rem;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 1px;
        }

        .selection-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* Submit Button */
        .submit-section {
            flex-shrink: 0;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0.4;
            transform: scale(0.95);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.2);
        }

        .submit-btn.enabled {
            opacity: 1;
            transform: scale(1);
            box-shadow: 0 12px 35px rgba(76, 175, 80, 0.4);
        }

        .submit-btn.enabled:active {
            transform: scale(0.98);
        }

        /* Player Change Popup */
        .player-change-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }

        .player-change-popup.show {
            display: flex;
        }

        .popup-content {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 40px 30px;
            text-align: center;
            max-width: 300px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: popupSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .popup-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 2rem;
            margin: 0 auto 20px;
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.4);
        }

        .popup-name {
            color: white;
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .popup-message {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            font-weight: 600;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes popupSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(30px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Results Section */
        .results-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .results-header {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.3));
            border: 2px solid rgba(76, 175, 80, 0.5);
            backdrop-filter: blur(30px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            text-align: center;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .results-summary {
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .results-grid {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
            flex: 1;
            align-content: start;
            max-height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
            width: 100%;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: 15px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            min-width: 0;
            width: 100%;
        }

        .player-result {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 0;
        }

        .result-avatar {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
            flex-shrink: 0;
        }

        .player-result-info {
            color: white;
            flex: 1;
            min-width: 0;
        }

        .player-result-name {
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-answer {
            font-size: 0.8rem;
            opacity: 0.8;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sips-penalty {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.3), rgba(244, 67, 54, 0.4));
            border: 1px solid #f44336;
            color: #f44336;
            padding: 6px 10px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 0.8rem;
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.2);
            flex-shrink: 0;
            white-space: nowrap;
        }

        .sips-penalty.none {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.4));
            border-color: #4CAF50;
            color: #4CAF50;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }

        .results-navigation {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            flex-shrink: 0;
        }

        .nav-btn {
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .nav-btn.secondary {
            background: rgba(255, 255, 255, 0.12);
            border: 2px solid rgba(255, 255, 255, 0.25);
            color: white;
            backdrop-filter: blur(20px);
        }

        .nav-btn:active {
            transform: scale(0.98);
        }

        /* Final Results Section - Kompakt f√ºr mobile */
        .final-results-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            padding: 0 5px;
        }

        .final-header {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.3));
            border: 2px solid rgba(255, 215, 0, 0.6);
            backdrop-filter: blur(30px);
            border-radius: 15px;
            padding: 12px 15px;
            margin-bottom: 12px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
        }

        .final-title {
            color: #FFD700;
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 4px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
        }

        .final-subtitle {
            color: rgba(255, 255, 255, 0.95);
            font-size: 0.85rem;
            font-weight: 600;
        }

        .leaderboard {
            flex: 1;
            margin-bottom: 12px;
            min-height: 0;
        }

        .leaderboard-title {
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 3px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .leaderboard-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.75rem;
            font-weight: 500;
            text-align: center;
            margin-bottom: 12px;
        }

        #leaderboard-list {
            display: grid;
            gap: 8px;
            max-height: 280px;
            overflow-y: auto;
        }

        .leaderboard-item {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: 15px;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .leaderboard-item.winner {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.3));
            border-color: #FFD700;
            transform: scale(1.01);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }

        .rank-number {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1rem;
            flex-shrink: 0;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.2);
        }

        .rank-1 { 
            background: linear-gradient(135deg, #FFD700, #FFA500); 
            color: white;
            animation: goldGlow 2s ease-in-out infinite alternate;
        }
        .rank-2 { 
            background: linear-gradient(135deg, #C0C0C0, #A0A0A0); 
            color: white; 
        }
        .rank-3 { 
            background: linear-gradient(135deg, #CD7F32, #B8860B); 
            color: white; 
        }
        .rank-other { 
            background: rgba(255, 255, 255, 0.2); 
            color: white; 
        }

        @keyframes goldGlow {
            0% { box-shadow: 0 3px 12px rgba(255, 215, 0, 0.3); }
            100% { box-shadow: 0 3px 18px rgba(255, 215, 0, 0.6); }
        }

        .result-avatar {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 0.9rem;
            box-shadow: 0 3px 12px rgba(79, 172, 254, 0.3);
            flex-shrink: 0;
        }

        .player-final-stats {
            flex: 1;
        }

        .player-final-name {
            color: white;
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 4px;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.3);
        }

        .player-final-details {
            color: rgba(255, 255, 255, 0.85);
            font-size: 0.8rem;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .detail-icon {
            font-size: 0.9rem;
        }

        .final-navigation {
            flex-shrink: 0;
        }

        .nav-btn.large {
            padding: 14px 20px;
            font-size: 1rem;
        }

        /* Toast Notifications */
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 15px;
            padding: 15px;
            z-index: 10000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 300px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .toast-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast-notification.success {
            border-color: rgba(76, 175, 80, 0.5);
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(76, 175, 80, 0.25));
        }

        .toast-notification.warning {
            border-color: rgba(255, 152, 0, 0.5);
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.15), rgba(255, 152, 0, 0.25));
        }

        .toast-notification.error {
            border-color: rgba(244, 67, 54, 0.5);
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.15), rgba(244, 67, 54, 0.25));
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .toast-icon {
            font-size: 1.2rem;
        }

        .toast-message {
            font-weight: 600;
            font-size: 0.8rem;
            line-height: 1.3;
        }

        /* Exit confirmation */
        .exit-confirmation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10001;
        }

        .exit-confirmation.show {
            display: flex;
        }

        .exit-content {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 320px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .exit-title {
            color: white;
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 15px;
        }

        .exit-message {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .exit-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .exit-btn {
            padding: 12px 20px;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .exit-btn.cancel {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .exit-btn.confirm {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .exit-btn:active {
            transform: scale(0.95);
        }

        /* Responsive Design */
        /* Responsive Design */
        @media (max-width: 480px) {
            .app-container {
                padding: 8px;
            }
            
            .question-text {
                font-size: 0.95rem;
            }
            
            .number-btn {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }

            .estimation-section {
                padding: 12px;
            }

            .selection-display {
                min-width: 80px;
                padding: 6px 10px;
            }

            .selection-number {
                font-size: 1rem;
            }

            .selection-label {
                font-size: 0.65rem;
            }

            .player-result-name {
                font-size: 0.9rem;
            }

            .player-answer {
                font-size: 0.75rem;
            }

            .sips-penalty {
                padding: 5px 8px;
                font-size: 0.75rem;
            }
        }

        @media (max-height: 700px) {
            .question-text {
                font-size: 0.9rem;
            }
            
            .number-btn {
                width: 40px;
                height: 40px;
                font-size: 0.9rem;
            }

            .estimation-section {
                padding: 12px;
            }

            .answer-btn {
                padding: 12px 8px;
            }

            .selection-display {
                padding: 6px 8px;
            }

            .selection-number {
                font-size: 1rem;
            }
        }

        @media (max-height: 600px) {
            .app-container {
                padding: 8px;
            }
            
            .game-header {
                padding: 8px 15px;
                margin-bottom: 8px;
            }

            .question-card {
                padding: 12px 15px;
                margin-bottom: 8px;
            }

            .current-player-card {
                padding: 10px 12px;
                margin-bottom: 8px;
            }

            .estimation-section {
                padding: 10px;
            }

            .number-btn {
                width: 35px;
                height: 35px;
                font-size: 0.8rem;
            }

            .answer-btn {
                padding: 12px 8px;
            }

            .answer-emoji {
                font-size: 1rem;
            }

            .selection-display {
                padding: 4px 6px;
                min-width: 70px;
            }

            .selection-number {
                font-size: 0.9rem;
            }

            .selection-label {
                font-size: 0.6rem;
            }

            .submit-btn {
                padding: 12px;
                font-size: 0.9rem;
            }
        }

        /* Verhindere horizontales Scrollen √ºberall */
        * {
            max-width: 100%;
            box-sizing: border-box;
        }

        .app-container, .game-content, .estimation-section, .results-section, .final-results-section {
            overflow-x: hidden;
            width: 100%;
        }

        /* Animations */
        .fadeInUp {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Background Particles -->
    <div class="background-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- App Container -->
    <div class="app-container">


        <!-- Main Game Content -->
        <div class="game-content">
            <!-- Question Card -->
            <div class="question-card fadeInUp">
                <div class="question-category" id="question-category">
                    üéÆ Loading...
                </div>
                <div class="question-text" id="question-text">
                    Lade Frage...
                </div>
            </div>

            <!-- Current Player -->
            <div class="current-player-card fadeInUp">
                <div class="player-avatar" id="current-avatar">M</div>
                <div class="player-info">
                    <div class="player-name" id="current-player-name">Max</div>
                    <div class="player-status">Du bist dran! <span id="player-progress">(1/4)</span></div>
                </div>
            </div>

            <!-- Answer Section -->
            <div class="answer-section fadeInUp" id="answer-section">
                <div class="answer-title">ü§î Deine Antwort</div>
                <div class="answer-buttons">
                    <button class="answer-btn yes" onclick="selectAnswer(true)" id="yes-btn">
                        <div class="answer-emoji">‚úÖ</div>
                        <div>Ja, habe ich</div>
                    </button>
                    <button class="answer-btn no" onclick="selectAnswer(false)" id="no-btn">
                        <div class="answer-emoji">‚ùå</div>
                        <div>Nein, noch nie</div>
                    </button>
                </div>
            </div>

            <!-- Estimation Section -->
            <div class="estimation-section fadeInUp" id="estimation-section">
                <div class="estimation-title">üéØ Wie viele antworten mit "Ja"?</div>
                
                <!-- Current Selection Display -->
                <div class="current-selection">
                    <div class="selection-display">
                        <div class="selection-number" id="selected-number">1</div>
                        <div class="selection-label">von <span id="total-players">0</span> Spielern</div>
                    </div>
                </div>

                <!-- Number Grid -->
                <div class="number-grid" id="number-grid">
                    <!-- Numbers will be generated dynamically -->
                </div>
            </div>

            <!-- Submit Button -->
            <div class="submit-section fadeInUp" id="submit-section">
                <button class="submit-btn" onclick="submitAnswer()" id="submit-btn">
                    üì§ Antwort best√§tigen
                </button>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="results-section" style="display: none;">
                <div class="results-header">
                    <div class="results-summary" id="results-summary"></div>
                </div>

                <div class="results-grid" id="results-grid">
                    <!-- Results will be populated dynamically -->
                </div>

                <div class="results-navigation">
                    <button class="nav-btn primary" onclick="nextQuestion()">
                        ‚û°Ô∏è N√§chste Frage
                    </button>
                    <button class="nav-btn secondary" onclick="endGame()">
                        üö™ Spiel beenden
                    </button>
                </div>
            </div>

            <!-- Final Results Section -->
            <div class="final-results-section" id="final-results-section" style="display: none;">
                <div class="final-header">
                    <div class="final-title">üèÜ Spiel beendet!</div>
                    <div class="final-subtitle">Hier sind die finalen Ergebnisse</div>
                </div>

                <div class="leaderboard">
                    <div class="leaderboard-title">üèÖ Rangliste</div>
                    <div class="leaderboard-subtitle">Sortiert nach wenigsten Schl√ºcken</div>
                    <div id="leaderboard-list">
                        <!-- Leaderboard will be populated dynamically -->
                    </div>
                </div>

                <div class="final-navigation">
                    <button class="nav-btn primary large" onclick="goHome()">
                        üè† Spiel beenden
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Player Change Popup -->
    <div class="player-change-popup" id="player-change-popup">
        <div class="popup-content">
            <div class="popup-avatar" id="popup-avatar">M</div>
            <div class="popup-name" id="popup-name">Max</div>
            <div class="popup-message">ist dran!</div>
        </div>
    </div>

    <!-- Exit Confirmation -->
    <div class="exit-confirmation" id="exit-confirmation">
        <div class="exit-content">
            <div class="exit-title">üö™ Spiel verlassen?</div>
            <div class="exit-message">M√∂chtest du das Spiel wirklich beenden? Der Fortschritt geht verloren.</div>
            <div class="exit-buttons">
                <button class="exit-btn cancel" onclick="cancelExit()">Nein, weiterspielen</button>
                <button class="exit-btn confirm" onclick="confirmExit()">Ja, beenden</button>
            </div>
        </div>
    </div>

    <script>
        // ===== GAME STATE MANAGEMENT =====
        class GameState {
            constructor() {
                this.deviceMode = null;
                this.selectedCategories = [];
                this.difficulty = null;
                this.players = [];
                this.gameId = null;
                this.playerName = null;
                this.isHost = false;
                this.isGuest = false;
                this.gameState = 'setup';
                this.timestamp = Date.now();
                
                this.loadFromStorage();
            }

            loadFromStorage() {
                try {
                    const saved = localStorage.getItem('denkstdu_game_state');
                    if (saved) {
                        const state = JSON.parse(saved);
                        if (state.timestamp && Date.now() - state.timestamp < 24 * 60 * 60 * 1000) {
                            this.deviceMode = state.deviceMode || null;
                            this.selectedCategories = state.selectedCategories || [];
                            this.difficulty = state.difficulty || null;
                            this.players = state.players || [];
                            this.gameId = state.gameId || null;
                            this.playerName = state.playerName || null;
                            this.isHost = state.isHost || false;
                            this.isGuest = state.isGuest || false;
                            this.gameState = state.gameState || 'setup';
                            
                            console.log('‚úÖ GameState loaded from storage:', this);
                            return true;
                        } else {
                            console.log('‚ö†Ô∏è GameState expired, clearing storage');
                            this.clearStorage();
                        }
                    }
                } catch (error) {
                    console.error('‚ùå Could not load game state:', error);
                    this.clearStorage();
                }
                return false;
            }

            clearStorage() {
                localStorage.removeItem('denkstdu_game_state');
            }
        }

        // ===== GLOBAL VARIABLES =====
        let gameState = null;
        let currentGame = {
            players: [],
            allQuestions: [],
            usedQuestions: [],
            currentQuestionNumber: 1,
            currentPlayerIndex: 0,
            currentAnswers: {},
            currentEstimates: {},
            gameHistory: []
        };

        // Questions Database
        const questionsDatabase = {
            fsk0: [
                "Ich habe schon mal... ein ganzes Buch an einem Tag gelesen",
                "Ich habe schon mal... Pizza zum Fr√ºhst√ºck gegessen", 
                "Ich habe schon mal... mehr als 12 Stunden am St√ºck geschlafen",
                "Ich habe schon mal... einen ganzen Tag im Pyjama verbracht",
                "Ich habe schon mal... beim Kochen das Essen anbrennen lassen",
                "Ich habe schon mal... mein Handy in die Toilette fallen lassen",
                "Ich habe schon mal... ein Lied komplett falsch mitgesungen",
                "Ich habe schon mal... heimlich S√º√üigkeiten vor dem Abendessen gegessen",
                "Ich habe schon mal... so getan, als w√ºrde ich schlafen",
                "Ich habe schon mal... einen Film dreimal hintereinander geschaut",
                "Ich habe schon mal... vergessen, wie ich nach Hause komme",
                "Ich habe schon mal... ein Tier im Haus versteckt",
                "Ich habe schon mal... aus Versehen Salz statt Zucker verwendet",
                "Ich habe schon mal... eine ganze Nacht durchgespielt",
                "Ich habe schon mal... beim Singen unter der Dusche gest√∂rt",
                "Ich habe schon mal... Essen vom Boden aufgehoben und gegessen",
                "Ich habe schon mal... ein Gespr√§ch mit mir selbst gef√ºhrt",
                "Ich habe schon mal... vergessen, dass ich etwas im Ofen hatte",
                "Ich habe schon mal... einen Tag lang nichts gesagt",
                "Ich habe schon mal... versucht, mit Tieren zu sprechen"
            ],
            fsk16: [
                "Ich habe schon mal... so getan, als w√§re ich krank, um nicht zur Schule zu m√ºssen",
                "Ich habe schon mal... bis 3 Uhr morgens Netflix geschaut",
                "Ich habe schon mal... ein Lied so laut gesungen, dass die Nachbarn sich beschwert haben",
                "Ich habe schon mal... vergessen, wo ich mein Auto geparkt habe",
                "Ich habe schon mal... bei einer Pr√ºfung geschummelt",
                "Ich habe schon mal... heimlich das Tagebuch von jemand anderem gelesen",
                "Ich habe schon mal... gelogen, um aus einer Verabredung herauszukommen",
                "Ich habe schon mal... mich richtig betrunken",
                "Ich habe schon mal... eine ganze Nacht durchgemacht",
                "Ich habe schon mal... heimlich geraucht",
                "Ich habe schon mal... ein Date versetzt",
                "Ich habe schon mal... aus dem Fenster geklettert",
                "Ich habe schon mal... einen Rausch vorget√§uscht",
                "Ich habe schon mal... bei einem Spiel betrogen",
                "Ich habe schon mal... Geld geklaut",
                "Ich habe schon mal... jemanden angelogen, um besser dazustehen",
                "Ich habe schon mal... eine Notl√ºge erz√§hlt, die v√∂llig eskaliert ist",
                "Ich habe schon mal... heimlich jemanden gek√ºsst",
                "Ich habe schon mal... mich vor der Polizei versteckt",
                "Ich habe schon mal... etwas Illegales getan"
            ],
            fsk18: [
                "Ich habe schon mal... an einem √∂ffentlichen Ort Sex gehabt",
                "Ich habe schon mal... eine Aff√§re gehabt",
                "Ich habe schon mal... in einer Beziehung betrogen",
                "Ich habe schon mal... einen Amateur-Porno gedreht",
                "Ich habe schon mal... einen Porno mit mehreren Personen zusammen angesehen",
                "Ich habe schon mal... Sex gehabt und es danach bereut",
                "Ich habe schon mal... Analsex gehabt",
                "Ich habe schon mal... einen Dreier gehabt",
                "Ich habe schon mal... mich vor Oralsex geekelt",
                "Ich habe schon mal... einen Blowjob gegeben",
                "Ich habe schon mal... einen Blowjob bekommen",
                "Ich habe schon mal... beim Sex gelacht",
                "Ich habe schon mal... einen Orgasmus gefaked",
                "Ich habe schon mal... f√ºr jemanden gestrippt",
                "Ich habe schon mal... f√ºr Sex bezahlt",
                "Ich habe schon mal... jemanden beim Sex verletzt",
                "Ich habe schon mal... Sex gehabt und dabei an jemand anderen gedacht",
                "Ich habe schon mal... mit einer verheirateten Person geschlafen",
                "Ich habe schon mal... Sex am Arbeitsplatz gehabt",
                "Ich habe schon mal... beim ersten Date Sex gehabt"
            ]
        };

        let isExitDialogShown = false;

        // ===== PAGE LEAVE PROTECTION =====
        window.addEventListener('beforeunload', function(e) {
            if (!isExitDialogShown) {
                e.preventDefault();
                e.returnValue = 'M√∂chtest du das Spiel wirklich verlassen? Der Fortschritt geht verloren.';
                return e.returnValue;
            }
        });

        // Handle back button and manual navigation
        window.addEventListener('popstate', function(e) {
            e.preventDefault();
            showExitConfirmation();
            history.pushState(null, null, window.location.pathname);
        });

        // Push initial state to enable back button interception
        history.pushState(null, null, window.location.pathname);

        function showExitConfirmation() {
            const exitDialog = document.getElementById('exit-confirmation');
            exitDialog.classList.add('show');
        }

        function cancelExit() {
            const exitDialog = document.getElementById('exit-confirmation');
            exitDialog.classList.remove('show');
        }

        function confirmExit() {
            try {
                // L√∂sche alle Daten
                localStorage.clear();
                sessionStorage.clear();
                
                // Deaktiviere alle Event Listener
                isExitDialogShown = true;
                
                // Force Redirect ohne Cache
                window.location.replace('index.html');
            } catch (error) {
                console.error('Exit error:', error);
                // Fallback: Force reload zur Startseite
                window.location.href = 'index.html?t=' + Date.now();
            }
        }

        function goHome() {
            // Direkte L√∂sung ohne Dialog f√ºr finale Ergebnisseite
            try {
                localStorage.clear();
                sessionStorage.clear();
                isExitDialogShown = true;
                window.location.replace('index.html');
            } catch (error) {
                window.location.href = 'index.html?t=' + Date.now();
            }
        }

        // ===== DEBUG / EMERGENCY EXIT =====
        function emergencyExit() {
            try {
                localStorage.clear();
                sessionStorage.clear();
                window.location.replace('index.html');
            } catch (error) {
                window.location.href = 'index.html?t=' + Date.now();
            }
        }

        // Emergency exit mit Tastenkombination
        window.addEventListener('keydown', function(e) {
            // Ctrl+Alt+E = Emergency Exit
            if (e.ctrlKey && e.altKey && e.key === 'e') {
                emergencyExit();
            }
        });

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
        });

        function initializeGame() {
            console.log('üéÆ Initializing endless single device gameplay...');
            
            // Load game state
            gameState = new GameState();
            
            // Validate game state
            if (!gameState.players || gameState.players.length < 2) {
                showNotification('Keine Spieler gefunden!', 'error');
                setTimeout(() => window.location.href = 'player-setup.html', 2000);
                return;
            }

            if (!gameState.selectedCategories || gameState.selectedCategories.length === 0) {
                showNotification('Keine Kategorien ausgew√§hlt!', 'error');
                setTimeout(() => window.location.href = 'category-selection.html', 2000);
                return;
            }

            if (!gameState.difficulty) {
                showNotification('Kein Schwierigkeitsgrad ausgew√§hlt!', 'error');
                setTimeout(() => window.location.href = 'difficulty-selection.html', 2000);
                return;
            }

            // Setup game
            currentGame.players = [...gameState.players];
            generateAllQuestions();
            
            // Initialize UI
            updateGameDisplay();
            createNumberGrid();
            
            // Start first question
            startNewQuestion();
            
            console.log('‚úÖ Endless game initialized:', {
                players: currentGame.players,
                categories: gameState.selectedCategories,
                difficulty: gameState.difficulty,
                totalQuestions: currentGame.allQuestions.length
            });
        }

        function generateAllQuestions() {
            currentGame.allQuestions = [];
            
            gameState.selectedCategories.forEach(category => {
                if (questionsDatabase[category]) {
                    questionsDatabase[category].forEach(q => {
                        currentGame.allQuestions.push({
                            text: q,
                            category: category
                        });
                    });
                }
            });
            
            // Shuffle questions
            currentGame.allQuestions = shuffleArray(currentGame.allQuestions);
        }

        function getNextQuestion() {
            // If we've used all questions, reshuffle and start over
            if (currentGame.usedQuestions.length >= currentGame.allQuestions.length) {
                currentGame.usedQuestions = [];
                currentGame.allQuestions = shuffleArray(currentGame.allQuestions);
                showNotification('Alle Fragen gespielt! Mische neu...', 'success');
            }

            // Find a question we haven't used yet
            for (let question of currentGame.allQuestions) {
                if (!currentGame.usedQuestions.includes(question.text)) {
                    currentGame.usedQuestions.push(question.text);
                    return question;
                }
            }

            // Fallback (shouldn't happen)
            return currentGame.allQuestions[0];
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // ===== GAME FLOW =====
        function updateGameDisplay() {
            document.getElementById('total-players').textContent = currentGame.players.length;
            
            // Update current player
            const currentPlayerName = currentGame.players[currentGame.currentPlayerIndex];
            document.getElementById('current-player-name').textContent = currentPlayerName;
            document.getElementById('current-avatar').textContent = currentPlayerName.charAt(0).toUpperCase();
            document.getElementById('player-progress').textContent = 
                `(${currentGame.currentPlayerIndex + 1}/${currentGame.players.length})`;
        }

        function startNewQuestion() {
            console.log(`üé≤ Starting question ${currentGame.currentQuestionNumber}`);
            
            // Reset for new question
            currentGame.currentPlayerIndex = 0;
            currentGame.currentAnswers = {};
            currentGame.currentEstimates = {};
            
            // Load next question
            const question = getNextQuestion();
            loadQuestion(question);
            
            // Reset UI
            resetPlayerUI();
            updateGameDisplay();
            
            // Show game view
            showGameView();
        }

        // ===== NAVIGATION =====
        function nextQuestion() {
            currentGame.currentQuestionNumber++;
            startNewQuestion();
            showNotification('Neue Frage geladen! üéÆ', 'success');
        }

        function endGame() {
            showFinalResults();
        }

        function goHome() {
            showExitConfirmation();
        }

        // ===== FINAL RESULTS =====
        function showFinalResults() {
            console.log('üèÜ Calculating final results...');
            
            // Calculate player statistics
            const playerStats = calculatePlayerStatistics();
            
            // Sort by fewest sips (best to worst)
            const finalRankings = playerStats.sort((a, b) => a.totalSips - b.totalSips);
            
            // Display final results
            displayFinalResults(finalRankings);
            
            // Switch to final results view
            showFinalResultsView();
        }

        function calculatePlayerStatistics() {
            const playerStats = {};
            
            // Initialize stats for each player
            currentGame.players.forEach(player => {
                playerStats[player] = {
                    playerName: player,
                    totalSips: 0,
                    correctGuesses: 0,
                    totalGuesses: 0,
                    accuracy: 0
                };
            });

            // Calculate stats from game history
            currentGame.gameHistory.forEach(round => {
                round.results.forEach(result => {
                    const stats = playerStats[result.playerName];
                    if (stats) {
                        stats.totalSips += result.sips;
                        stats.totalGuesses++;
                        if (result.isCorrect) {
                            stats.correctGuesses++;
                        }
                    }
                });
            });

            // Calculate accuracy percentage
            Object.values(playerStats).forEach(stats => {
                stats.accuracy = stats.totalGuesses > 0 ? 
                    Math.round((stats.correctGuesses / stats.totalGuesses) * 100) : 0;
            });

            return Object.values(playerStats);
        }

        function displayFinalResults(finalRankings) {
            // Build leaderboard
            const leaderboardList = document.getElementById('leaderboard-list');
            leaderboardList.innerHTML = '';
            
            finalRankings.forEach((player, index) => {
                const leaderboardItem = document.createElement('div');
                leaderboardItem.className = `leaderboard-item ${index === 0 ? 'winner' : ''}`;
                
                const rankClass = index === 0 ? 'rank-1' : 
                                 index === 1 ? 'rank-2' : 
                                 index === 2 ? 'rank-3' : 'rank-other';
                
                const rankText = index + 1;
                const avatar = player.playerName.charAt(0).toUpperCase();
                
                leaderboardItem.innerHTML = `
                    <div class="rank-number ${rankClass}">${rankText}</div>
                    <div class="result-avatar">${avatar}</div>
                    <div class="player-final-stats">
                        <div class="player-final-name">${player.playerName}</div>
                        <div class="player-final-details">
                            <div class="detail-item">
                                <span class="detail-icon">üç∫</span>
                                <span>${player.totalSips} Schl√ºcke</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-icon">üéØ</span>
                                <span>${player.accuracy}% richtig</span>
                            </div>
                        </div>
                    </div>
                `;
                
                leaderboardList.appendChild(leaderboardItem);
            });

            showNotification(
                `üèÜ ${finalRankings[0].playerName} hat gewonnen!`, 
                'success', 
                3000
            );
        }

        function showFinalResultsView() {
            // Hide all other sections
            const questionCard = document.querySelector('.question-card');
            const answerSection = document.getElementById('answer-section');
            const estimationSection = document.getElementById('estimation-section');
            const submitSection = document.getElementById('submit-section');
            const currentPlayerCard = document.querySelector('.current-player-card');
            const resultsSection = document.getElementById('results-section');
            
            if (questionCard) questionCard.style.display = 'none';
            if (answerSection) answerSection.style.display = 'none';
            if (estimationSection) estimationSection.style.display = 'none';
            if (submitSection) submitSection.style.display = 'none';
            if (currentPlayerCard) currentPlayerCard.style.display = 'none';
            if (resultsSection) resultsSection.style.display = 'none';
            
            // Show final results
            const finalResultsSection = document.getElementById('final-results-section');
            if (finalResultsSection) {
                finalResultsSection.style.display = 'flex';
            }
        }

        function loadQuestion(question) {
            const categoryNames = {
                'fsk0': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie & Freunde',
                'fsk16': 'üéâ Party Time',
                'fsk18': 'üî• Hei√ü & Gewagt'
            };
            
            document.getElementById('question-text').textContent = question.text;
            document.getElementById('question-category').textContent = categoryNames[question.category] || 'üéÆ Spiel';
        }

        function resetPlayerUI() {
            // Reset answer buttons
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Reset number selection
            updateSelectedNumber(Math.floor(currentGame.players.length / 2));
            updateNumberSelection();
            updateSubmitButton();
        }

        // ===== UI CONTROLS =====
        function createNumberGrid() {
            const numberGrid = document.getElementById('number-grid');
            numberGrid.innerHTML = '';

            for (let i = 0; i <= currentGame.players.length; i++) {
                const numberBtn = document.createElement('button');
                numberBtn.className = 'number-btn';
                numberBtn.textContent = i;
                numberBtn.onclick = () => selectNumber(i);
                numberBtn.id = `number-btn-${i}`;
                
                numberGrid.appendChild(numberBtn);
            }
            
            updateNumberSelection();
        }

        function selectNumber(number) {
            if (number >= 0 && number <= currentGame.players.length) {
                currentEstimation = number;
                updateSelectedNumber(number);
                updateNumberSelection();
                updateSubmitButton();
                
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
            }
        }

        function updateSelectedNumber(number) {
            document.getElementById('selected-number').textContent = number;
            
            const selectionDisplay = document.querySelector('.selection-display');
            selectionDisplay.style.transform = 'scale(1.05)';
            setTimeout(() => {
                selectionDisplay.style.transform = 'scale(1)';
            }, 200);
        }

        function updateNumberSelection() {
            document.querySelectorAll('.number-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            const selectedBtn = document.getElementById(`number-btn-${currentEstimation}`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
            }
        }

        function selectAnswer(answer) {
            currentAnswer = answer;
            
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            const selectedBtn = answer ? document.getElementById('yes-btn') : document.getElementById('no-btn');
            selectedBtn.classList.add('selected');
            
            updateSubmitButton();
        }

        function updateSubmitButton() {
            const submitBtn = document.getElementById('submit-btn');
            if (currentAnswer !== null) {
                submitBtn.classList.add('enabled');
                submitBtn.disabled = false;
            } else {
                submitBtn.classList.remove('enabled');
                submitBtn.disabled = true;
            }
        }

        // ===== GAME ACTIONS =====
        let currentAnswer = null;
        let currentEstimation = 1;

        function submitAnswer() {
            if (currentAnswer === null) {
                showNotification('Bitte w√§hle eine Antwort aus!', 'warning');
                return;
            }

            const currentPlayerName = currentGame.players[currentGame.currentPlayerIndex];
            
            // Save answers
            currentGame.currentAnswers[currentPlayerName] = currentAnswer;
            currentGame.currentEstimates[currentPlayerName] = currentEstimation;
            
            console.log(`üì§ ${currentPlayerName} answered:`, {
                answer: currentAnswer,
                estimation: currentEstimation
            });

            // Move to next player or show results
            if (currentGame.currentPlayerIndex < currentGame.players.length - 1) {
                currentGame.currentPlayerIndex++;
                currentAnswer = null;
                currentEstimation = Math.floor(currentGame.players.length / 2);
                resetPlayerUI();
                updateGameDisplay();
                
                // Show player change popup
                showPlayerChangePopup();
            } else {
                // All players answered, show quick results
                showQuickResults();
            }
        }

        // ===== PLAYER CHANGE POPUP =====
        function showPlayerChangePopup() {
            const currentPlayerName = currentGame.players[currentGame.currentPlayerIndex];
            
            document.getElementById('popup-name').textContent = currentPlayerName;
            document.getElementById('popup-avatar').textContent = currentPlayerName.charAt(0).toUpperCase();
            
            const popup = document.getElementById('player-change-popup');
            popup.classList.add('show');
            
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
            }
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 2000);
        }

        // ===== RESULTS =====
        function showResults() {
            console.log('üìä Calculating results...');
            
            // Calculate actual yes count
            const actualYesCount = Object.values(currentGame.currentAnswers).filter(answer => answer === true).length;
            
            // Calculate results for each player
            const results = currentGame.players.map(playerName => {
                const answer = currentGame.currentAnswers[playerName];
                const estimation = currentGame.currentEstimates[playerName];
                const difference = Math.abs(estimation - actualYesCount);
                const isCorrect = difference === 0;
                
                // Calculate sips based on difficulty
                let sips = 0;
                if (!isCorrect) {
                    const baseSips = getDifficultyMultiplier();
                    sips = baseSips + difference;
                }
                
                return {
                    playerName: playerName,
                    answer: answer,
                    estimation: estimation,
                    difference: difference,
                    isCorrect: isCorrect,
                    sips: sips
                };
            });
            
            // Save to game history
            currentGame.gameHistory.push({
                questionNumber: currentGame.currentQuestionNumber,
                actualYesCount: actualYesCount,
                results: results
            });
            
            // Display results
            displayResults(results, actualYesCount);
            
            // Switch to results view
            showResultsView();
        }

        function showResultsView() {
            // Hide game elements
            document.getElementById('answer-section').style.display = 'none';
            document.getElementById('estimation-section').style.display = 'none';
            document.getElementById('submit-section').style.display = 'none';
            document.querySelector('.current-player-card').style.display = 'none';
            
            // Show results
            document.getElementById('results-section').style.display = 'flex';
            
            showNotification('Ergebnisse werden angezeigt...', 'success', 2000);
        }

        function showGameView() {
            // Show game elements
            document.getElementById('answer-section').style.display = 'block';
            document.getElementById('estimation-section').style.display = 'flex';
            document.getElementById('submit-section').style.display = 'block';
            document.querySelector('.current-player-card').style.display = 'flex';
            
            // Hide results
            document.getElementById('results-section').style.display = 'none';
        }

        function getDifficultyMultiplier() {
            switch (gameState.difficulty) {
                case 'easy': return 1;
                case 'hard': return 3;
                default: return 2; // medium
            }
        }

        function displayResults(results, actualYesCount) {
            // Update summary
            document.getElementById('results-summary').textContent = 
                `${actualYesCount} von ${currentGame.players.length} Spielern haben "Ja" geantwortet`;

            // Sort results: first correct guesses, then by fewest sips
            const sortedResults = results.sort((a, b) => {
                // First sort by correctness (correct first)
                if (a.isCorrect && !b.isCorrect) return -1;
                if (!a.isCorrect && b.isCorrect) return 1;
                // If both correct or both wrong, sort by sips (fewer first)
                return a.sips - b.sips;
            });

            // Display individual results
            const resultsGrid = document.getElementById('results-grid');
            resultsGrid.innerHTML = '';

            sortedResults.forEach(result => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                
                const avatar = result.playerName.charAt(0).toUpperCase();
                const sipsText = result.sips === 0 ? 'Perfekt! üéØ' : `${result.sips} üç∫`;
                const sipsClass = result.sips === 0 ? 'none' : '';

                resultItem.innerHTML = `
                    <div class="player-result">
                        <div class="result-avatar">${avatar}</div>
                        <div class="player-result-info">
                            <div class="player-result-name">${result.playerName}</div>
                            <div class="player-answer">Tipp: ${result.estimation}</div>
                        </div>
                    </div>
                    <div class="sips-penalty ${sipsClass}">${sipsText}</div>
                `;

                resultsGrid.appendChild(resultItem);
            });
        }

        function submitAnswer() {
            if (currentAnswer === null) {
                showNotification('Bitte w√§hle eine Antwort aus!', 'warning');
                return;
            }

            const currentPlayerName = currentGame.players[currentGame.currentPlayerIndex];
            
            // Save answers
            currentGame.currentAnswers[currentPlayerName] = currentAnswer;
            currentGame.currentEstimates[currentPlayerName] = currentEstimation;
            
            console.log(`üì§ ${currentPlayerName} answered:`, {
                answer: currentAnswer,
                estimation: currentEstimation
            });

            // Move to next player or show results
            if (currentGame.currentPlayerIndex < currentGame.players.length - 1) {
                currentGame.currentPlayerIndex++;
                currentAnswer = null;
                currentEstimation = Math.floor(currentGame.players.length / 2);
                resetPlayerUI();
                updateGameDisplay();
                
                // Show player change popup
                showPlayerChangePopup();
            } else {
                // All players answered, show results
                showResults();
            }
        }

        // ===== UTILITY FUNCTIONS =====
        function showNotification(message, type = 'info', duration = 3000) {
            // Remove existing notifications
            document.querySelectorAll('.toast-notification').forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `toast-notification ${type}`;
            notification.innerHTML = `
                <div class="toast-content">
                    <div class="toast-icon">${type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Remove after duration
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, duration);
        }

        // ===== DEBUG FUNCTIONS =====
        window.debugGame = function() {
            console.log('üîç Game Debug Info:');
            console.log('GameState:', gameState);
            console.log('Current Game:', currentGame);
        };

        window.showGameStats = function() {
            const totalQuestions = currentGame.gameHistory.length;
            const totalPlayers = currentGame.players.length;
            
            console.log(`üìä Game Stats:`);
            console.log(`Questions played: ${totalQuestions}`);
            console.log(`Players: ${totalPlayers}`);
            console.log(`Questions available: ${currentGame.allQuestions.length}`);
            console.log(`Questions used: ${currentGame.usedQuestions.length}`);
            
            // Player stats
            const playerStats = {};
            currentGame.players.forEach(player => {
                playerStats[player] = {
                    totalSips: 0,
                    correctGuesses: 0,
                    totalGuesses: 0
                };
            });

            currentGame.gameHistory.forEach(round => {
                round.results.forEach(result => {
                    const stats = playerStats[result.playerName];
                    if (stats) {
                        stats.totalSips += result.sips;
                        stats.totalGuesses++;
                        if (result.isCorrect) {
                            stats.correctGuesses++;
                        }
                    }
                });
            });

            console.log('Player Stats:', playerStats);
        };

        console.log('‚úÖ Endless Single Device Gameplay loaded');
        console.log('üéÆ Debug Commands:');
        console.log('- debugGame() - Show debug info');
        console.log('- showGameStats() - Show game statistics');
    </script>
</body>
</html>