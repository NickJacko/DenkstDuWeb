<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DenkstDu - Spielen</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
    <!-- Background Particles -->
    <div class="background-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- App Container -->
    <div class="app-container">
        
        <!-- Phase 1: Frage anzeigen + Ja/Nein Abstimmung -->
        <div class="screen active" id="voting-phase">
            <div class="content-area">
                <!-- Game Header -->
                <div class="game-header">
                    <div class="game-info">
                        <div class="round-display">
                            Runde <span id="current-round">1</span>/<span id="total-rounds">10</span>
                        </div>
                        <div class="current-player" id="current-player-display">
                            <span class="player-avatar">üë§</span>
                            <span class="player-name" id="current-player-name">Max</span>
                        </div>
                    </div>
                    <div class="game-actions">
                        <button class="btn btn-outline btn-small" onclick="showPauseMenu()">‚è∏Ô∏è Pause</button>
                    </div>
                </div>

                <!-- Question Card -->
                <div class="glass-card question-card">
                    <div class="question-header">
                        <div class="question-category" id="question-category">üéâ Party Time</div>
                        <div class="question-icon">ü§î</div>
                    </div>
                    <h2 class="question-text" id="question-text">
                        Denkst du, dass [Player] schon mal nackt gebadet hat?
                    </h2>
                    <div class="question-subtitle">
                        Stimme ab - deine Antwort bleibt geheim!
                    </div>
                </div>

                <!-- Voting Buttons -->
                <div class="voting-section">
                    <div class="vote-buttons">
                        <button class="vote-btn yes-btn" onclick="submitVote('yes')" id="yes-btn">
                            <div class="vote-emoji">‚úÖ</div>
                            <div class="vote-label">Ja</div>
                            <div class="vote-subtitle">Glaube ich schon</div>
                        </button>
                        <button class="vote-btn no-btn" onclick="submitVote('no')" id="no-btn">
                            <div class="vote-emoji">‚ùå</div>
                            <div class="vote-label">Nein</div>
                            <div class="vote-subtitle">Glaube ich nicht</div>
                        </button>
                    </div>
                    
                    <div class="voting-status" id="voting-status">
                        <div class="status-text">W√§hle deine Antwort</div>
                        <div class="voting-progress" id="voting-progress">
                            <div class="progress-text">
                                <span id="votes-count">0</span> von <span id="total-players">4</span> haben abgestimmt
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="voting-progress-fill"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 2: Sch√§tzen -->
        <div class="screen" id="estimation-phase">
            <div class="content-area">
                <div class="glass-card">
                    <div class="estimation-header">
                        <div class="estimation-icon">üîÆ</div>
                        <h2 class="estimation-title">Jetzt sch√§tzen!</h2>
                        <p class="estimation-subtitle">
                            Wie viele haben <strong>"Ja"</strong> gesagt?
                        </p>
                    </div>

                    <!-- Estimation Counter -->
                    <div class="estimation-section">
                        <div class="estimation-counter">
                            <button class="counter-btn" onclick="changeEstimation(-1)" id="minus-btn">‚àí</button>
                            <div class="counter-display">
                                <div class="estimation-number" id="estimation-display">2</div>
                                <div class="estimation-label">von <span id="max-estimation">4</span></div>
                            </div>
                            <button class="counter-btn" onclick="changeEstimation(1)" id="plus-btn">+</button>
                        </div>
                        
                        <button class="btn estimation-btn" onclick="submitEstimation()" id="submit-estimation-btn">
                            üéØ Sch√§tzung abgeben
                        </button>
                    </div>

                    <!-- Estimation Progress -->
                    <div class="estimation-progress" id="estimation-progress-section" style="display: none;">
                        <div class="progress-text">
                            <span id="estimations-count">0</span> von <span id="total-players-est">4</span> haben gesch√§tzt
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="estimation-progress-fill"></div>
                        </div>
                        <div class="waiting-text">Warte auf andere Spieler...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 3: Ergebnisse -->
        <div class="screen" id="results-phase">
            <div class="content-area">
                <div class="glass-card results-card">
                    <div class="results-header">
                        <div class="results-icon">üéä</div>
                        <h2 class="results-title">Aufl√∂sung!</h2>
                        <div class="actual-result">
                            <div class="result-number" id="actual-yes-count">3</div>
                            <div class="result-text">haben "Ja" gesagt</div>
                        </div>
                    </div>

                    <!-- Results List -->
                    <div class="results-list" id="results-list">
                        <!-- Ergebnisse werden hier eingef√ºgt -->
                    </div>

                    <!-- Round Summary -->
                    <div class="round-summary" id="round-summary">
                        <div class="summary-item best-guess">
                            <span class="summary-emoji">üèÜ</span>
                            <span class="summary-text" id="best-guesser">Anna lag genau richtig!</span>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="results-actions">
                        <button class="btn btn-outline" onclick="showScoreboard()">üìä Zwischenstand</button>
                        <button class="btn" onclick="nextRound()" id="next-round-btn">
                            ‚û°Ô∏è N√§chste Frage
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Final Results -->
        <div class="screen" id="final-results-phase">
            <div class="content-area">
                <div class="glass-card final-card">
                    <div class="final-header">
                        <div class="final-icon">üèÖ</div>
                        <h2 class="final-title">Spiel beendet!</h2>
                        <div class="final-subtitle">Endstand nach <span id="final-rounds">10</span> Fragen</div>
                    </div>

                    <!-- Winner Display -->
                    <div class="winner-display" id="winner-display">
                        <div class="winner-crown">üëë</div>
                        <div class="winner-name" id="winner-name">Anna</div>
                        <div class="winner-score">
                            <span id="winner-points">85</span> Punkte
                        </div>
                    </div>

                    <!-- Final Rankings -->
                    <div class="final-rankings" id="final-rankings">
                        <!-- Rankings werden hier eingef√ºgt -->
                    </div>

                    <!-- Game Stats -->
                    <div class="game-stats">
                        <div class="stat-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="total-exact-guesses">12</div>
                                <div class="stat-label">Exakte Treffer</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="total-sips">156</div>
                                <div class="stat-label">Schl√ºcke insgesamt</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="average-deviation">1.8</div>
                                <div class="stat-label">√ò Abweichung</div>
                            </div>
                        </div>
                    </div>

                    <!-- Final Actions -->
                    <div class="final-actions">
                        <button class="btn btn-outline" onclick="saveAndExit()">
                            üíæ Speichern & Beenden
                        </button>
                        <button class="btn" onclick="playAgain()">
                            üîÑ Nochmal spielen
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pause Menu Modal -->
    <div class="modal" id="pause-modal" style="display: none;">
        <div class="modal-content">
            <h3>‚è∏Ô∏è Spiel pausiert</h3>
            <p>Was m√∂chtest du tun?</p>
            <div class="modal-buttons">
                <button class="btn btn-outline" onclick="resumeGame()">‚ñ∂Ô∏è Weiterspielen</button>
                <button class="btn btn-secondary" onclick="showScoreboard()">üìä Zwischenstand</button>
                <button class="btn btn-danger" onclick="confirmEndGame()">üèÅ Spiel beenden</button>
            </div>
        </div>
    </div>

    <!-- Scoreboard Modal -->
    <div class="modal" id="scoreboard-modal" style="display: none;">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>üìä Zwischenstand</h3>
                <button class="close-btn" onclick="closeScoreboard()">‚úï</button>
            </div>
            <div class="scoreboard-content" id="scoreboard-content">
                <!-- Scoreboard wird hier eingef√ºgt -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/gameState.js"></script>
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/privacy.js"></script>
    <script>
        // Game Variables
        let currentPhase = 'voting';
        let currentEstimation = 2;
        let hasVoted = false;
        let hasEstimated = false;
        let gameResults = [];
        let isGameHost = true;

        // Initialize gameplay
        function initGameplay() {
            // Check if we have a valid game state
            if (!gameState.isValidGame()) {
                showNotification('Kein g√ºltiges Spiel gefunden!', 'error');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
                return;
            }

            // Initialize Firebase if multiplayer
            if (gameState.deviceMode === 'multi') {
                initFirebase();
                setupMultiplayerListeners();
            }

            // Load initial game data
            loadGameData();
            
            // Start first round
            startRound();

            // Initialize mobile optimizations
            initMobileOptimizations();
        }

        // Load game data into UI
        function loadGameData() {
            // Update round display
            document.getElementById('current-round').textContent = gameState.currentRound;
            document.getElementById('total-rounds').textContent = gameState.totalRounds;
            
            // Update player count
            const playerCount = gameState.players.length;
            document.getElementById('total-players').textContent = playerCount;
            document.getElementById('total-players-est').textContent = playerCount;
            document.getElementById('max-estimation').textContent = playerCount;
            
            // Set estimation limits
            currentEstimation = Math.min(currentEstimation, playerCount);
            document.getElementById('estimation-display').textContent = currentEstimation;
            
            // Update category display
            updateCategoryDisplay();
        }

        // Update category display
        function updateCategoryDisplay() {
            const categoryInfo = gameState.getCategoryInfo();
            if (categoryInfo.length > 0) {
                const firstCategory = categoryInfo[0];
                document.getElementById('question-category').innerHTML = `${firstCategory.emoji} ${firstCategory.name}`;
            }
        }

        // Start a new round
        function startRound() {
            // Reset round state
            hasVoted = false;
            hasEstimated = false;
            
            // Load question
            const question = gameState.getCurrentQuestion();
            if (question) {
                document.getElementById('question-text').textContent = question;
                updateCurrentPlayer();
            } else {
                // No more questions - end game
                endGame();
                return;
            }

            // Switch to voting phase
            switchToPhase('voting');
            resetVotingUI();
        }

        // Update current player display
        function updateCurrentPlayer() {
            const currentPlayer = gameState.getCurrentPlayer();
            if (currentPlayer) {
                document.getElementById('current-player-name').textContent = currentPlayer;
                
                // Show different avatar for current player
                const avatar = document.querySelector('.player-avatar');
                avatar.textContent = 'üëë';
            }
        }

        // Switch between phases
        function switchToPhase(phase) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });

            // Show target screen
            const targetScreen = document.getElementById(phase + '-phase');
            if (targetScreen) {
                targetScreen.classList.add('active');
                currentPhase = phase;
            }
        }

        // Submit vote (Ja/Nein)
        function submitVote(vote) {
            if (hasVoted) {
                showNotification('Du hast bereits abgestimmt!', 'warning');
                return;
            }

            // Store vote locally or send to Firebase
            if (gameState.deviceMode === 'single') {
                // In single device mode, auto-proceed to estimation
                hasVoted = true;
                markVoteSubmitted();
                
                setTimeout(() => {
                    switchToPhase('estimation');
                    resetEstimationUI();
                }, 1000);
            } else {
                // Multiplayer mode - send to Firebase
                submitVoteToFirebase(vote);
            }
        }

        // Mark vote as submitted
        function markVoteSubmitted() {
            document.getElementById('yes-btn').disabled = true;
            document.getElementById('no-btn').disabled = true;
            document.getElementById('yes-btn').style.opacity = '0.5';
            document.getElementById('no-btn').style.opacity = '0.5';
            
            document.getElementById('voting-status').innerHTML = `
                <div class="status-text voted">‚úÖ Abgestimmt!</div>
            `;
        }

        // Change estimation value
        function changeEstimation(delta) {
            const maxPlayers = gameState.players.length;
            currentEstimation = Math.max(0, Math.min(maxPlayers, currentEstimation + delta));
            
            document.getElementById('estimation-display').textContent = currentEstimation;
            
            // Update button states
            document.getElementById('minus-btn').disabled = currentEstimation <= 0;
            document.getElementById('plus-btn').disabled = currentEstimation >= maxPlayers;
        }

        // Submit estimation
        function submitEstimation() {
            if (hasEstimated) {
                showNotification('Du hast bereits gesch√§tzt!', 'warning');
                return;
            }

            hasEstimated = true;
            
            // Add vote to game state
            gameState.addVote(gameState.getCurrentPlayer(), currentEstimation);
            
            // Mark as submitted
            markEstimationSubmitted();
            
            // In single device mode, proceed to next player or results
            if (gameState.deviceMode === 'single') {
                setTimeout(() => {
                    proceedToNextPlayer();
                }, 1000);
            } else {
                // Multiplayer - wait for others
                showEstimationProgress();
            }
        }

        // Mark estimation as submitted
        function markEstimationSubmitted() {
            document.getElementById('submit-estimation-btn').disabled = true;
            document.getElementById('submit-estimation-btn').style.opacity = '0.5';
            document.getElementById('submit-estimation-btn').innerHTML = '‚úÖ Gesch√§tzt!';
        }

        // Show estimation progress
        function showEstimationProgress() {
            document.getElementById('estimation-progress-section').style.display = 'block';
            updateEstimationProgress();
        }

        // Update estimation progress
        function updateEstimationProgress() {
            const progress = gameState.getEstimationProgress();
            document.getElementById('estimations-count').textContent = progress.estimated;
            
            const progressBar = document.getElementById('estimation-progress-fill');
            progressBar.style.width = `${progress.percentage}%`;
        }

        // Proceed to next player (single device mode)
        function proceedToNextPlayer() {
            const votingProgress = gameState.getVotingProgress();
            
            if (votingProgress.remaining > 0) {
                // More players need to vote - continue voting
                startRound();
            } else {
                // All players voted - show results
                showRoundResults();
            }
        }

        // Show round results
        function showRoundResults() {
            // Calculate actual "Ja" count (simplified for demo)
            const actualYesCount = Math.floor(Math.random() * gameState.players.length) + 1;
            
            // Calculate round results
            const roundResults = gameState.calculateRoundResults(actualYesCount);
            
            // Display results
            document.getElementById('actual-yes-count').textContent = actualYesCount;
            displayPlayerResults(roundResults);
            
            // Switch to results phase
            switchToPhase('results');
            
            // Update next round button
            const isLastRound = gameState.currentRound >= gameState.totalRounds;
            const nextBtn = document.getElementById('next-round-btn');
            if (isLastRound) {
                nextBtn.innerHTML = 'üèÅ Zum Endergebnis';
            } else {
                nextBtn.innerHTML = '‚û°Ô∏è N√§chste Frage';
            }
        }

        // Display player results
        function displayPlayerResults(results) {
            const resultsList = document.getElementById('results-list');
            resultsList.innerHTML = '';

            results.forEach((result, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                if (result.isExact) resultItem.classList.add('exact-guess');

                resultItem.innerHTML = `
                    <div class="result-player">
                        <span class="result-rank">${index + 1}</span>
                        <span class="result-name">${result.player}</span>
                    </div>
                    <div class="result-details">
                        <span class="result-estimation">Sch√§tzung: ${result.votedCount}</span>
                        <span class="result-difference ${result.isExact ? 'exact' : ''}">${
                            result.isExact ? 'Exakt!' : `${result.difference} daneben`
                        }</span>
                    </div>
                    <div class="result-sips ${result.sips === 0 ? 'no-sips' : ''}">
                        ${result.sips === 0 ? 'üèÜ' : result.sips + ' üç∫'}
                    </div>
                `;

                resultsList.appendChild(resultItem);
            });

            // Update best guesser
            const bestGuesser = results.find(r => r.isExact) || results[0];
            document.getElementById('best-guesser').textContent = 
                bestGuesser.isExact ? 
                `${bestGuesser.player} lag genau richtig!` : 
                `${bestGuesser.player} war am n√§chsten dran!`;
        }

        // Next round
        function nextRound() {
            const hasNextRound = gameState.nextRound();
            
            if (hasNextRound) {
                // Start next round
                startRound();
            } else {
                // Game finished
                endGame();
            }
        }

        // End game and show final results
        function endGame() {
            const finalResults = gameState.getFinalResults();
            displayFinalResults(finalResults);
            switchToPhase('final-results');
        }

        // Display final results
        function displayFinalResults(results) {
            if (results.length === 0) return;

            // Show winner
            const winner = results[0];
            document.getElementById('winner-name').textContent = winner.name;
            document.getElementById('winner-points').textContent = winner.score;
            
            // Show rankings
            const rankingsList = document.getElementById('final-rankings');
            rankingsList.innerHTML = '';

            results.forEach((player, index) => {
                const rankItem = document.createElement('div');
                rankItem.className = 'ranking-item';
                if (index === 0) rankItem.classList.add('winner');

                rankItem.innerHTML = `
                    <div class="ranking-position">
                        <span class="rank-number ${index < 3 ? ['first', 'second', 'third'][index] : ''}">${index + 1}</span>
                        <span class="rank-name">${player.name}</span>
                    </div>
                    <div class="ranking-stats">
                        <div class="rank-score">${player.score} Punkte</div>
                        <div class="rank-details">${player.exactGuesses} exakt, ${player.totalSips} Schl√ºcke</div>
                    </div>
                `;

                rankingsList.appendChild(rankItem);
            });

            // Update game stats
            const totalExact = results.reduce((sum, p) => sum + p.exactGuesses, 0);
            const totalSips = results.reduce((sum, p) => sum + p.totalSips, 0);
            const avgDeviation = results.reduce((sum, p) => sum + p.avgDifference, 0) / results.length;

            document.getElementById('total-exact-guesses').textContent = totalExact;
            document.getElementById('total-sips').textContent = totalSips;
            document.getElementById('average-deviation').textContent = avgDeviation.toFixed(1);
            document.getElementById('final-rounds').textContent = gameState.currentRound - 1;
        }

        // Pause menu functions
        function showPauseMenu() {
            document.getElementById('pause-modal').style.display = 'flex';
        }

        function resumeGame() {
            document.getElementById('pause-modal').style.display = 'none';
        }

        function confirmEndGame() {
            if (confirm('Spiel wirklich beenden? Der Fortschritt geht verloren.')) {
                gameState.clearStorage();
                window.location.href = 'index.html';
            }
        }

        // Scoreboard functions
        function showScoreboard() {
            document.getElementById('pause-modal').style.display = 'none';
            
            const finalResults = gameState.getFinalResults();
            const scoreboardContent = document.getElementById('scoreboard-content');
            scoreboardContent.innerHTML = '';

            finalResults.forEach((player, index) => {
                const scoreItem = document.createElement('div');
                scoreItem.className = 'scoreboard-item';
                scoreItem.innerHTML = `
                    <div class="score-rank">${index + 1}</div>
                    <div class="score-name">${player.name}</div>
                    <div class="score-points">${player.score}</div>
                    <div class="score-stats">${player.exactGuesses}/${player.rounds} exakt</div>
                `;
                scoreboardContent.appendChild(scoreItem);
            });

            document.getElementById('scoreboard-modal').style.display = 'flex';
        }

        function closeScoreboard() {
            document.getElementById('scoreboard-modal').style.display = 'none';
        }

        // Final actions
        function saveAndExit() {
            // Save game results for statistics
            const gameData = gameState.exportGameData();
            localStorage.setItem('denkstdu_last_game', JSON.stringify(gameData));
            
            showNotification('Spiel gespeichert!', 'success');
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1500);
        }

        function playAgain() {
            // Keep same settings but reset game
            const categories = gameState.selectedCategories;
            const difficulty = gameState.difficulty;
            const players = gameState.players;
            
            gameState.reset();
            gameState.selectedCategories = categories;
            gameState.difficulty = difficulty;
            gameState.setPlayers(players);
            gameState.initializeGame();
            
            // Restart
            startRound();
        }

        // UI Reset functions
        function resetVotingUI() {
            document.getElementById('yes-btn').disabled = false;
            document.getElementById('no-btn').disabled = false;
            document.getElementById('yes-btn').style.opacity = '1';
            document.getElementById('no-btn').style.opacity = '1';
            
            document.getElementById('voting-status').innerHTML = `
                <div class="status-text">W√§hle deine Antwort</div>
            `;
            
            // Reset progress
            document.getElementById('votes-count').textContent = '0';
            document.getElementById('voting-progress-fill').style.width = '0%';
        }

        function resetEstimationUI() {
            document.getElementById('submit-estimation-btn').disabled = false;
            document.getElementById('submit-estimation-btn').style.opacity = '1';
            document.getElementById('submit-estimation-btn').innerHTML = 'üéØ Sch√§tzung abgeben';
            
            document.getElementById('estimation-progress-section').style.display = 'none';
            
            // Reset estimation to middle value
            currentEstimation = Math.ceil(gameState.players.length / 2);
            document.getElementById('estimation-display').textContent = currentEstimation;
        }

        // Multiplayer functions (simplified)
        function setupMultiplayerListeners() {
            // In a real implementation, this would set up Firebase listeners
            console.log('Setting up multiplayer listeners...');
        }

        function submitVoteToFirebase(vote) {
            // In a real implementation, this would submit to Firebase
            console.log('Submitting vote to Firebase:', vote);
            hasVoted = true;
            markVoteSubmitted();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initGameplay);

        // Handle page visibility for multiplayer
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Page hidden - pause multiplayer updates
                console.log('Page hidden');
            } else {
                // Page visible - resume multiplayer updates
                console.log('Page visible');
            }
        });
    </script>

    <style>
        /* Gameplay Specific Styles */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .game-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .round-display {
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .current-player {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            border-radius: 20px;
        }

        .player-avatar {
            font-size: 1.2rem;
        }

        .player-name {
            color: white;
            font-weight: 600;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .question-card {
            text-align: center;
            margin-bottom: 30px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-category {
            background: rgba(79, 172, 254, 0.3);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .question-icon {
            font-size: 2rem;
        }

        .question-text {
            color: white;
            font-size: 1.4rem;
            font-weight: 600;
            line-height: 1.4;
            margin: 15px 0;
        }

        .question-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        /* Voting Section */
        .voting-section {
            margin-bottom: 20px;
        }

        .vote-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .vote-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            color: white;
        }

        .vote-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .vote-btn.yes-btn:hover:not(:disabled) {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
        }

        .vote-btn.no-btn:hover:not(:disabled) {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.2);
        }

        .vote-emoji {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .vote-label {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .vote-subtitle {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .voting-status {
            text-align: center;
        }

        .status-text {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .status-text.voted {
            color: #4CAF50;
            font-weight: 600;
        }

        .voting-progress {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }

        .progress-text {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* Estimation Section */
        .estimation-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .estimation-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .estimation-title {
            color: white;
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .estimation-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
        }

        .estimation-section {
            text-align: center;
        }

        .estimation-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .counter-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .counter-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
            border-color: #4facfe;
            transform: scale(1.1);
        }

        .counter-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .counter-display {
            text-align: center;
        }

        .estimation-number {
            font-size: 3rem;
            font-weight: 800;
            color: #4facfe;
            text-shadow: 0 0 20px rgba(79, 172, 254, 0.5);
        }

        .estimation-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .estimation-btn {
            width: 100%;
            max-width: 300px;
            margin: 20px auto;
            font-size: 1.1rem;
            padding: 18px;
        }

        .estimation-progress {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
        }

        .waiting-text {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            font-style: italic;
            margin-top: 10px;
        }

        /* Results Section */
        .results-card {
            text-align: center;
        }

        .results-header {
            margin-bottom: 30px;
        }

        .results-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .results-title {
            color: white;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .actual-result {
            background: rgba(79, 172, 254, 0.3);
            border: 2px solid #4facfe;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
        }

        .result-number {
            font-size: 3rem;
            font-weight: 800;
            color: #4facfe;
            display: block;
            text-shadow: 0 0 20px rgba(79, 172, 254, 0.5);
        }

        .result-text {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .results-list {
            margin: 25px 0;
            text-align: left;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 4px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .result-item.exact-guess {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
        }

        .result-player {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .result-rank {
            background: #4facfe;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .result-name {
            color: white;
            font-weight: 600;
            font-size: 1rem;
        }

        .result-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
            text-align: center;
        }

        .result-estimation {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85rem;
        }

        .result-difference {
            color: #ff6b6b;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .result-difference.exact {
            color: #4CAF50;
        }

        .result-sips {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            min-width: 60px;
            text-align: center;
        }

        .result-sips.no-sips {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            font-size: 1.2rem;
        }

        .round-summary {
            margin: 20px 0;
        }

        .summary-item {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #FFD700;
            border-radius: 10px;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .summary-emoji {
            font-size: 1.5rem;
        }

        .summary-text {
            color: white;
            font-weight: 600;
        }

        .results-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .results-actions .btn {
            flex: 1;
        }

        /* Final Results */
        .final-card {
            text-align: center;
        }

        .final-header {
            margin-bottom: 30px;
        }

        .final-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .final-title {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .final-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
        }

        .winner-display {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #FFD700;
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
        }

        .winner-crown {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .winner-name {
            color: white;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .winner-score {
            color: #FFD700;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .final-rankings {
            margin: 25px 0;
            text-align: left;
        }

        .ranking-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ranking-item.winner {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #FFD700;
        }

        .ranking-position {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .rank-number {
            background: #4facfe;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .rank-number.first {
            background: #FFD700;
            color: #000;
        }

        .rank-number.second {
            background: #C0C0C0;
            color: #000;
        }

        .rank-number.third {
            background: #CD7F32;
            color: white;
        }

        .rank-name {
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .ranking-stats {
            text-align: right;
        }

        .rank-score {
            color: #4facfe;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .rank-details {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
        }

        .game-stats {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            color: #4facfe;
            font-size: 1.8rem;
            font-weight: 700;
            display: block;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .final-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .final-actions .btn {
            flex: 1;
        }

        /* Scoreboard Modal */
        .scoreboard-content {
            max-height: 400px;
            overflow-y: auto;
        }

        .scoreboard-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .score-rank {
            background: #4facfe;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .score-name {
            flex: 1;
            color: white;
            font-weight: 600;
        }

        .score-points {
            color: #4facfe;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .score-stats {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .game-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .game-info {
                flex-direction: column;
                gap: 8px;
            }

            .vote-buttons {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .estimation-counter {
                gap: 15px;
            }

            .counter-btn {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }

            .estimation-number {
                font-size: 2.5rem;
            }

            .result-item {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .result-player,
            .result-details,
            .result-sips {
                width: 100%;
                justify-content: center;
            }

            .results-actions {
                flex-direction: column;
            }

            .final-actions {
                flex-direction: column;
            }

            .stat-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .ranking-item {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .ranking-position,
            .ranking-stats {
                width: 100%;
                justify-content: center;
            }
        }

        /* Animation Classes */
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }

        .fade-in-up {
            animation: fadeInUp 0.4s ease-out;
        }

        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Loading Enhancement */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .loading.show {
            display: flex;
        }

        /* Accessibility Improvements */
        .vote-btn:focus,
        .counter-btn:focus,
        .btn:focus {
            outline: 2px solid #4facfe;
            outline-offset: 2px;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .glass-card {
                background: rgba(255, 255, 255, 0.9);
                color: #000;
            }

            .vote-btn,
            .counter-btn {
                border-color: #000;
                color: #000;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>