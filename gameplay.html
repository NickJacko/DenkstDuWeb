<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DenkstDu - Spielrunde</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
    <!-- Background Particles -->
    <div class="background-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Back Button -->
    <button class="back-button" onclick="showEndGameDialog()">üèÅ Spiel beenden</button>

    <!-- App Container -->
    <div class="app-container">
        
        <!-- Phase 1: Frage anzeigen + Ja/Nein Abstimmung -->
        <div class="screen active" id="voting-phase">
            <div class="content-area">
                <!-- Game Progress -->
                <div class="game-header">
                    <div class="round-info">
                        <span class="round-number">Frage <span id="current-round">1</span></span>
                        <span class="question-category" id="question-category">üéâ Party Time</span>
                    </div>
                    <div class="players-connected">
                        <span id="connected-count">4</span> Spieler online
                    </div>
                </div>

                <!-- Question Card -->
                <div class="glass-card question-card">
                    <div class="question-icon">ü§î</div>
                    <h2 class="question-text" id="question-text">
                        Hast du schon mal nackt gebadet?
                    </h2>
                    <div class="question-subtitle">
                        Antworte ehrlich - niemand sieht deine Antwort!
                    </div>
                </div>

                <!-- Voting Buttons -->
                <div class="voting-section">
                    <div class="vote-buttons">
                        <button class="vote-btn yes-btn" onclick="submitVote('yes')" id="yes-btn">
                            <div class="vote-emoji">‚úÖ</div>
                            <div class="vote-label">Ja</div>
                            <div class="vote-subtitle">Hab ich schon</div>
                        </button>
                        <button class="vote-btn no-btn" onclick="submitVote('no')" id="no-btn">
                            <div class="vote-emoji">‚ùå</div>
                            <div class="vote-label">Nein</div>
                            <div class="vote-subtitle">Noch nie</div>
                        </button>
                    </div>
                </div>

                <!-- Voting Progress -->
                <div class="voting-progress">
                    <div class="progress-info">
                        <span id="votes-received">0</span> von <span id="total-players">4</span> haben abgestimmt
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="voting-progress-fill"></div>
                    </div>
                    <div class="waiting-message" id="waiting-message">
                        Warte auf andere Spieler...
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 2: Sch√§tzen wie viele "Ja" gesagt haben -->
        <div class="screen" id="estimation-phase">
            <div class="content-area">
                <div class="glass-card">
                    <div class="estimation-header">
                        <div class="estimation-icon">üîÆ</div>
                        <h2 class="estimation-title">Jetzt sch√§tzen!</h2>
                        <p class="estimation-subtitle">
                            Wie viele haben wohl <strong>"Ja"</strong> gesagt?
                        </p>
                    </div>

                    <!-- Estimation Input -->
                    <div class="estimation-input-section">
                        <div class="estimation-counter">
                            <button class="counter-btn minus" onclick="changeEstimation(-1)">‚àí</button>
                            <div class="counter-display">
                                <input type="number" 
                                       class="estimation-input" 
                                       id="estimation-input" 
                                       min="0" 
                                       max="8" 
                                       value="2" 
                                       readonly>
                                <div class="counter-label">von <span id="max-players">4</span> Spielern</div>
                            </div>
                            <button class="counter-btn plus" onclick="changeEstimation(1)">+</button>
                        </div>
                    </div>

                    <!-- Submit Estimation -->
                    <button class="btn estimation-submit-btn" onclick="submitEstimation()" id="submit-estimation">
                        üéØ Sch√§tzung abgeben
                    </button>

                    <!-- Estimation Progress -->
                    <div class="estimation-progress">
                        <div class="progress-info">
                            <span id="estimations-received">0</span> von <span id="total-players-est">4</span> haben gesch√§tzt
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="estimation-progress-fill"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 3: Aufl√∂sung und Trink-Strafen -->
        <div class="screen" id="results-phase">
            <div class="content-area">
                <div class="glass-card results-card">
                    <!-- Results Header -->
                    <div class="results-header">
                        <div class="results-icon">üéä</div>
                        <h2 class="results-title">Aufl√∂sung!</h2>
                        <div class="actual-result">
                            <span class="result-number" id="actual-yes-count">3</span>
                            <span class="result-text">haben "Ja" gesagt</span>
                        </div>
                    </div>

                    <!-- Player Results -->
                    <div class="player-results" id="player-results">
                        <!-- Results werden dynamisch eingef√ºgt -->
                    </div>

                    <!-- Best/Worst Performers -->
                    <div class="round-highlights" id="round-highlights">
                        <div class="highlight best-guess">
                            <span class="highlight-emoji">üèÜ</span>
                            <span class="highlight-text">
                                <strong>Anna</strong> lag genau richtig!
                            </span>
                        </div>
                    </div>

                    <!-- Next Round Button -->
                    <button class="btn next-round-btn" onclick="nextRound()" id="next-round-btn">
                        ‚û°Ô∏è N√§chste Frage
                    </button>
                </div>
            </div>
        </div>

        <!-- Final Results Screen -->
        <div class="screen" id="final-results-phase">
            <div class="content-area">
                <div class="glass-card final-results-card">
                    <div class="final-header">
                        <div class="final-icon">üèÖ</div>
                        <h2 class="final-title">Spiel beendet!</h2>
                        <div class="final-subtitle">Das waren alle Fragen</div>
                    </div>

                    <!-- Final Rankings -->
                    <div class="final-rankings" id="final-rankings">
                        <!-- Rankings werden dynamisch eingef√ºgt -->
                    </div>

                    <!-- Final Stats -->
                    <div class="final-stats" id="final-stats">
                        <div class="stat-item">
                            <span class="stat-label">Gespielt:</span>
                            <span class="stat-value"><span id="total-rounds-played">10</span> Fragen</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Beste Sch√§tzung:</span>
                            <span class="stat-value" id="best-guesser">Anna (5 exakt)</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Meist getrunken:</span>
                            <span class="stat-value" id="most-drinks">Max (23 Schl√ºcke)</span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="final-actions">
                        <button class="btn btn-outline" onclick="goToMainMenu()">
                            üè† Hauptmen√º
                        </button>
                        <button class="btn" onclick="startNewGame()">
                            üîÑ Neues Spiel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- End Game Dialog -->
    <div class="modal" id="end-game-modal" style="display: none;">
        <div class="modal-content">
            <h3>Spiel wirklich beenden?</h3>
            <p>Das aktuelle Spiel wird abgebrochen und alle Fortschritte gehen verloren.</p>
            <div class="modal-buttons">
                <button class="btn btn-outline" onclick="hideEndGameDialog()">Weiterspielen</button>
                <button class="btn btn-danger" onclick="confirmEndGame()">Spiel beenden</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/gameState.js"></script>
    <script src="assets/js/utils.js"></script>
    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyC_cu_2X2uFCPcxYetxIUHi2v56F1Mz0Vk",
            authDomain: "denkstduwebsite.firebaseapp.com",
            projectId: "denkstduwebsite",
            storageBucket: "denkstduwebsite.firebasestorage.app",
            messagingSenderId: "27029260611",
            appId: "1:27029260611:web:3c7da4db0bf92e8ce247f6",
            measurementId: "G-BNKNW95HK8"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // Game Variables
        let gameId = localStorage.getItem('activeGameId');
        let playerName = localStorage.getItem('playerName');
        let currentPhase = 'voting';
        let hasVoted = false;
        let hasEstimated = false;
        let currentQuestion = null;
        let gameData = null;

        // Initialize Gameplay
        function initGameplay() {
            if (!gameId || !playerName) {
                showNotification('Spieldaten fehlen!', 'error');
                setTimeout(() => window.location.href = 'index.html', 2000);
                return;
            }

            // Load game state
            loadGameState();
            
            // Listen for game updates
            listenForGameUpdates();
            
            // Initialize mobile optimizations
            initMobileOptimizations();
        }

        // Load current game state
        function loadGameState() {
            showLoading();
            
            db.ref(`games/${gameId}`).once('value', (snapshot) => {
                gameData = snapshot.val();
                
                if (!gameData) {
                    showNotification('Spiel nicht gefunden!', 'error');
                    setTimeout(() => window.location.href = 'index.html', 2000);
                    return;
                }

                hideLoading();
                updateGameDisplay();
                determineCurrentPhase();
            });
        }

        // Listen for real-time game updates
        function listenForGameUpdates() {
            db.ref(`games/${gameId}`).on('value', (snapshot) => {
                const newGameData = snapshot.val();
                
                if (newGameData) {
                    gameData = newGameData;
                    updateGameDisplay();
                    determineCurrentPhase();
                }
            });
        }

        // Update game display with current data
        function updateGameDisplay() {
            if (!gameData) return;

            // Update round info
            document.getElementById('current-round').textContent = gameData.currentRound || 1;
            
            // Update player count
            const playerCount = Object.keys(gameData.players || {}).length;
            document.getElementById('connected-count').textContent = playerCount;
            document.getElementById('total-players').textContent = playerCount;
            document.getElementById('total-players-est').textContent = playerCount;
            document.getElementById('max-players').textContent = playerCount;

            // Update question
            if (gameData.currentQuestion) {
                currentQuestion = gameData.currentQuestion;
                document.getElementById('question-text').textContent = currentQuestion.text;
                document.getElementById('question-category').textContent = getCategoryEmoji(currentQuestion.category) + ' ' + getCategoryName(currentQuestion.category);
            }

            // Update voting progress
            if (gameData.currentVotes) {
                const votesCount = Object.keys(gameData.currentVotes).length;
                document.getElementById('votes-received').textContent = votesCount;
                updateProgressBar('voting-progress-fill', votesCount, playerCount);
            }

            // Update estimation progress
            if (gameData.currentEstimations) {
                const estimationsCount = Object.keys(gameData.currentEstimations).length;
                document.getElementById('estimations-received').textContent = estimationsCount;
                updateProgressBar('estimation-progress-fill', estimationsCount, playerCount);
            }
        }

        // Determine and switch to current phase
        function determineCurrentPhase() {
            if (!gameData) return;

            const phase = gameData.phase || 'voting';
            
            if (phase !== currentPhase) {
                switchToPhase(phase);
                currentPhase = phase;
            }

            // Check user's participation status
            if (gameData.currentVotes && gameData.currentVotes[playerName]) {
                hasVoted = true;
                markVoteSubmitted();
            }

            if (gameData.currentEstimations && gameData.currentEstimations[playerName]) {
                hasEstimated = true;
                markEstimationSubmitted();
            }
        }

        // Switch between game phases
        function switchToPhase(phase) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });

            // Show target screen with animation
            const targetScreen = document.getElementById(phase + '-phase');
            if (targetScreen) {
                setTimeout(() => {
                    targetScreen.classList.add('active');
                }, 300);
            }

            // Phase-specific setup
            switch(phase) {
                case 'voting':
                    resetVotingPhase();
                    break;
                case 'estimation':
                    resetEstimationPhase();
                    break;
                case 'results':
                    showRoundResults();
                    break;
                case 'final-results':
                    showFinalResults();
                    break;
            }
        }

        // Submit vote (Ja/Nein)
        function submitVote(vote) {
            if (hasVoted) {
                showNotification('Du hast bereits abgestimmt!', 'warning');
                return;
            }

            // Submit to Firebase
            db.ref(`games/${gameId}/currentVotes/${playerName}`).set({
                vote: vote,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });

            hasVoted = true;
            markVoteSubmitted();
            showNotification(vote === 'yes' ? '‚úÖ Ja abgestimmt' : '‚ùå Nein abgestimmt', 'success');
        }

        // Mark vote as submitted in UI
        function markVoteSubmitted() {
            document.getElementById('yes-btn').disabled = true;
            document.getElementById('no-btn').disabled = true;
            document.getElementById('yes-btn').style.opacity = '0.5';
            document.getElementById('no-btn').style.opacity = '0.5';
            
            document.getElementById('waiting-message').textContent = 'Deine Stimme wurde abgegeben!';
        }

        // Change estimation value
        function changeEstimation(delta) {
            const input = document.getElementById('estimation-input');
            const currentValue = parseInt(input.value);
            const maxPlayers = Object.keys(gameData.players || {}).length;
            
            let newValue = currentValue + delta;
            newValue = Math.max(0, Math.min(maxPlayers, newValue));
            
            input.value = newValue;
        }

        // Submit estimation
        function submitEstimation() {
            if (hasEstimated) {
                showNotification('Du hast bereits gesch√§tzt!', 'warning');
                return;
            }

            const estimation = parseInt(document.getElementById('estimation-input').value);
            
            // Submit to Firebase
            db.ref(`games/${gameId}/currentEstimations/${playerName}`).set({
                estimation: estimation,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });

            hasEstimated = true;
            markEstimationSubmitted();
            showNotification(`üéØ ${estimation} gesch√§tzt!`, 'success');
        }

        // Mark estimation as submitted
        function markEstimationSubmitted() {
            document.getElementById('submit-estimation').disabled = true;
            document.getElementById('submit-estimation').style.opacity = '0.5';
            document.getElementById('submit-estimation').textContent = '‚úÖ Sch√§tzung abgegeben';
        }

        // Show round results
        function showRoundResults() {
            if (!gameData.roundResult) return;

            const result = gameData.roundResult;
            
            // Show actual result
            document.getElementById('actual-yes-count').textContent = result.actualYesCount;

            // Show player results
            const resultsContainer = document.getElementById('player-results');
            resultsContainer.innerHTML = '';

            Object.entries(result.playerResults || {}).forEach(([player, data]) => {
                const resultItem = createPlayerResultItem(player, data);
                resultsContainer.appendChild(resultItem);
            });

            // Show highlights
            showRoundHighlights(result);
        }

        // Create player result item
        function createPlayerResultItem(playerName, resultData) {
            const item = document.createElement('div');
            item.className = 'player-result-item';
            
            const difference = Math.abs(resultData.estimation - resultData.actualCount);
            const isExact = difference === 0;
            
            item.innerHTML = `
                <div class="result-player">
                    <span class="player-emoji">${playerName === this.playerName ? 'üëë' : 'üë§'}</span>
                    <span class="player-name">${playerName}</span>
                </div>
                <div class="result-details">
                    <span class="estimation">Sch√§tzung: ${resultData.estimation}</span>
                    <span class="difference ${isExact ? 'exact' : ''}">${isExact ? 'Exakt!' : `${difference} daneben`}</span>
                </div>
                <div class="result-sips">
                    <span class="sips-count">${resultData.sips}</span>
                    <span class="sips-label">Schl√ºcke</span>
                </div>
            `;

            if (isExact) {
                item.classList.add('exact-guess');
            }

            return item;
        }

        // Show round highlights
        function showRoundHighlights(result) {
            const highlightsContainer = document.getElementById('round-highlights');
            highlightsContainer.innerHTML = '';

            // Find best and worst performers
            const playerResults = Object.entries(result.playerResults || {});
            
            const bestPlayer = playerResults.reduce((best, [player, data]) => {
                const difference = Math.abs(data.estimation - data.actualCount);
                const bestDiff = Math.abs(best.data.estimation - best.data.actualCount);
                return difference < bestDiff ? {player, data} : best;
            });

            if (bestPlayer) {
                const isExact = Math.abs(bestPlayer.data.estimation - bestPlayer.data.actualCount) === 0;
                const highlight = document.createElement('div');
                highlight.className = 'highlight best-guess';
                highlight.innerHTML = `
                    <span class="highlight-emoji">${isExact ? 'üèÜ' : 'üéØ'}</span>
                    <span class="highlight-text">
                        <strong>${bestPlayer.player}</strong> ${isExact ? 'lag genau richtig!' : 'war am n√§chsten dran!'}
                    </span>
                `;
                highlightsContainer.appendChild(highlight);
            }
        }

        // Move to next round
        function nextRound() {
            if (gameData.gameCreator !== playerName) {
                showNotification('Nur der Gastgeber kann die n√§chste Runde starten!', 'warning');
                return;
            }

            // Reset for next round
            db.ref(`games/${gameId}`).update({
                phase: 'voting',
                currentRound: (gameData.currentRound || 1) + 1,
                currentVotes: null,
                currentEstimations: null,
                roundResult: null
            });

            // Generate new question
            generateNewQuestion();
        }

        // Generate new question based on categories
        function generateNewQuestion() {
            const questions = gameState.generateQuestions();
            const roundIndex = (gameData.currentRound || 1) - 1;
            
            if (roundIndex < questions.length) {
                const question = questions[roundIndex];
                
                db.ref(`games/${gameId}/currentQuestion`).set({
                    text: question,
                    category: gameState.selectedCategories[0], // Simplification
                    round: gameData.currentRound || 1
                });
            } else {
                // Game finished
                db.ref(`games/${gameId}/phase`).set('final-results');
            }
        }

        // Reset phases
        function resetVotingPhase() {
            hasVoted = false;
            document.getElementById('yes-btn').disabled = false;
            document.getElementById('no-btn').disabled = false;
            document.getElementById('yes-btn').style.opacity = '1';
            document.getElementById('no-btn').style.opacity = '1';
            document.getElementById('waiting-message').textContent = 'Warte auf andere Spieler...';
        }

        function resetEstimationPhase() {
            hasEstimated = false;
            document.getElementById('submit-estimation').disabled = false;
            document.getElementById('submit-estimation').style.opacity = '1';
            document.getElementById('submit-estimation').textContent = 'üéØ Sch√§tzung abgeben';
        }

        // Helper functions
        function getCategoryEmoji(category) {
            const emojis = {
                'fsk0': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
                'fsk16': 'üéâ',
                'fsk18': 'üî•'
            };
            return emojis[category] || 'ü§î';
        }

        function getCategoryName(category) {
            const names = {
                'fsk0': 'Familie & Freunde',
                'fsk16': 'Party Time',
                'fsk18': 'Hei√ü & Gewagt'
            };
            return names[category] || 'Unbekannt';
        }

        function updateProgressBar(elementId, current, total) {
            const progressBar = document.getElementById(elementId);
            if (progressBar) {
                const percentage = total > 0 ? (current / total) * 100 : 0;
                progressBar.style.width = `${percentage}%`;
            }
        }

        // End game functions
        function showEndGameDialog() {
            document.getElementById('end-game-modal').style.display = 'flex';
        }

        function hideEndGameDialog() {
            document.getElementById('end-game-modal').style.display = 'none';
        }

        function confirmEndGame() {
            // Clean up Firebase listeners
            db.ref(`games/${gameId}`).off();
            
            // Clear local storage
            localStorage.removeItem('activeGameId');
            localStorage.removeItem('playerName');
            
            // Navigate to main menu
            window.location.href = 'index.html';
        }

        function goToMainMenu() {
            confirmEndGame();
        }

        function startNewGame() {
            // Keep player name but reset game
            localStorage.removeItem('activeGameId');
            window.location.href = 'device-selection.html';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initGameplay);
    </script>

    <style>
        /* Additional Gameplay Styles */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .round-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .round-number {
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .question-category {
            color: #4facfe;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .players-connected {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .question-card {
            text-align: center;
            margin-bottom: 30px;
        }

        .question-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .question-text {
            color: white;
            font-size: 1.4rem;
            font-weight: 600;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .question-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .voting-section {
            margin-bottom: 30px;
        }

        .vote-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .vote-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            color: white;
        }

        .vote-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .vote-btn.yes-btn:hover {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
        }

        .vote-btn.no-btn:hover {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.2);
        }

        .vote-emoji {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .vote-label {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .vote-subtitle {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .voting-progress,
        .estimation-progress {
            text-align: center;
        }

        .progress-info {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .waiting-message {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            font-style: italic;
        }

        /* Estimation Phase */
        .estimation-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .estimation-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .estimation-title {
            color: white;
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .estimation-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
        }

        .estimation-input-section {
            margin: 30px 0;
        }

        .estimation-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .counter-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .counter-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: #4facfe;
            transform: scale(1.1);
        }

        .counter-display {
            text-align: center;
        }

        .estimation-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #4facfe;
            border-radius: 15px;
            padding: 15px;
            font-size: 2rem;
            font-weight: 700;
            color: white;
            text-align: center;
            width: 80px;
            margin-bottom: 5px;
        }

        .counter-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .estimation-submit-btn {
            width: 100%;
            margin-bottom: 20px;
            font-size: 1.1rem;
            padding: 18px;
        }

        /* Results Phase */
        .results-card {
            text-align: center;
        }

        .results-header {
            margin-bottom: 30px;
        }

        .results-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .results-title {
            color: white;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .actual-result {
            background: rgba(79, 172, 254, 0.3);
            border: 2px solid #4facfe;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
        }

        .result-number {
            font-size: 3rem;
            font-weight: 800;
            color: #4facfe;
            display: block;
        }

        .result-text {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .player-results {
            margin: 30px 0;
        }

        .player-result-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 4px solid rgba(255, 255, 255, 0.3);
        }

        .player-result-item.exact-guess {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
        }

        .result-player {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-emoji {
            font-size: 1.2rem;
        }

        .player-name {
            color: white;
            font-weight: 600;
        }

        .result-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
            text-align: center;
        }

        .estimation {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .difference {
            color: #ff6b6b;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .difference.exact {
            color: #4CAF50;
        }

        .result-sips {
            text-align: center;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            padding: 8px 12px;
            border-radius: 20px;
            min-width: 60px;
        }

        .sips-count {
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            display: block;
        }

        .sips-label {
            color: white;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .round-highlights {
            margin: 20px 0;
        }

        .highlight {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #FFD700;
            border-radius: 10px;
            padding: 12px 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .highlight-emoji {
            font-size: 1.5rem;
        }

        .highlight-text {
            color: white;
            font-size: 0.95rem;
        }

        .next-round-btn {
            width: 100%;
            font-size: 1.1rem;
            padding: 18px;
            margin-top: 20px;
        }

        /* Final Results */
        .final-results-card {
            text-align: center;
        }

        .final-header {
            margin-bottom: 30px;
        }

        .final-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .final-title {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .final-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
        }

        .final-rankings {
            margin: 30px 0;
        }

        .ranking-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ranking-item.winner {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #FFD700;
        }

        .ranking-position {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .position-number {
            background: #4facfe;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .position-number.first {
            background: #FFD700;
            color: #000;
        }

        .position-number.second {
            background: #C0C0C0;
            color: #000;
        }

        .position-number.third {
            background: #CD7F32;
            color: white;
        }

        .ranking-name {
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .ranking-stats {
            text-align: right;
        }

        .total-sips {
            color: #ff6b6b;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .exact-guesses {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
        }

        .final-stats {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .stat-value {
            color: #4facfe;
            font-weight: 600;
        }

        .final-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .final-actions .btn {
            flex: 1;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            color: white;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-content h3 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: white;
        }

        .modal-content p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
        }

        .modal-buttons .btn {
            flex: 1;
            padding: 12px 20px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .game-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .vote-buttons {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .vote-btn {
                padding: 15px;
            }

            .vote-emoji {
                font-size: 1.5rem;
            }

            .estimation-counter {
                gap: 15px;
            }

            .counter-btn {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }

            .estimation-input {
                width: 70px;
                font-size: 1.8rem;
                padding: 12px;
            }

            .player-result-item {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .result-player,
            .result-details,
            .result-sips {
                width: 100%;
                justify-content: center;
            }

            .final-actions {
                flex-direction: column;
            }

            .modal-buttons {
                flex-direction: column;
            }
        }

        /* Animation Classes */
        .slide-in-up {
            animation: slideInUp 0.5s ease-out;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Loading State */
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10000;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(79, 172, 254, 0.6);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(79, 172, 254, 0.8);
        }
    </style>
</body>
</html>