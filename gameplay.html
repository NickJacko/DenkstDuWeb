<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>DenkstDu - Spielen</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
            position: relative;
        }

        /* Background Particles */
        .background-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            animation: float 15s ease-in-out infinite;
        }

        .particle:nth-child(1) { width: 100px; height: 100px; left: 10%; animation-delay: 0s; }
        .particle:nth-child(2) { width: 60px; height: 60px; left: 80%; animation-delay: 3s; }
        .particle:nth-child(3) { width: 80px; height: 80px; left: 30%; animation-delay: 6s; }
        .particle:nth-child(4) { width: 120px; height: 120px; left: 70%; animation-delay: 9s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
            25% { transform: translateY(-30px) rotate(90deg); opacity: 0.6; }
            50% { transform: translateY(-60px) rotate(180deg); opacity: 0.3; }
            75% { transform: translateY(-30px) rotate(270deg); opacity: 0.6; }
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 15px;
            max-width: 450px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            border-radius: 25px;
            padding: 18px 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .game-info {
            color: white;
        }

        .device-mode {
            font-size: 0.8rem;
            opacity: 0.9;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .question-counter {
            font-size: 1.1rem;
            font-weight: 800;
        }

        .players-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .players-indicator {
            width: 10px;
            height: 10px;
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        /* Game Phases */
        .game-phase {
            display: none;
        }

        .game-phase.active {
            display: block;
        }

        /* Question Card */
        .question-card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            padding: 35px 30px;
            margin-bottom: 30px;
            text-align: center;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .question-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #4CAF50, #2196F3, #9C27B0);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 200% 0; }
            50% { background-position: -200% 0; }
        }

        .question-category {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.25), rgba(76, 175, 80, 0.35));
            border: 1px solid rgba(76, 175, 80, 0.5);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 700;
            display: inline-block;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .question-text {
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
            line-height: 1.5;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Current Player Display */
        .current-player-card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
        }

        .player-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 1.3rem;
            box-shadow: 0 5px 20px rgba(79, 172, 254, 0.3);
            flex-shrink: 0;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            color: white;
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .player-status {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
        }

        /* Answer Section */
        .answer-section {
            margin-bottom: 35px;
        }

        .answer-title {
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .answer-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .answer-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.25);
            color: white;
            padding: 25px 20px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            min-height: 100px;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .answer-btn:active {
            transform: scale(0.95);
        }

        .answer-btn.selected {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .answer-btn.yes.selected {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.4));
            border-color: #4CAF50;
            box-shadow: 0 15px 40px rgba(76, 175, 80, 0.3);
        }

        .answer-btn.no.selected {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.3), rgba(244, 67, 54, 0.4));
            border-color: #f44336;
            box-shadow: 0 15px 40px rgba(244, 67, 54, 0.3);
        }

        .answer-emoji {
            font-size: 2rem;
        }

        /* Estimation Section */
        .estimation-section {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: 25px;
            padding: 30px 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
        }

        .estimation-title {
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Number Grid */
        .number-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
            justify-items: center;
        }

        .number-btn {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.25);
            color: white;
            border-radius: 50%;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(20px);
        }

        .number-btn:active {
            transform: scale(0.9);
        }

        .number-btn.selected {
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            border-color: #4CAF50;
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
            color: white;
        }

        /* Current Selection Display */
        .current-selection {
            text-align: center;
            margin-bottom: 25px;
        }

        .selection-display {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 20px;
            display: inline-block;
            min-width: 200px;
        }

        .selection-number {
            color: white;
            font-size: 2.5rem;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
        }

        .selection-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            font-weight: 600;
        }

        /* Submit Button */
        .submit-section {
            margin-bottom: 30px;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 22px;
            border-radius: 25px;
            font-size: 1.3rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0.4;
            transform: scale(0.95);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.2);
        }

        .submit-btn.enabled {
            opacity: 1;
            transform: scale(1);
            box-shadow: 0 15px 40px rgba(76, 175, 80, 0.4);
        }

        .submit-btn.enabled:active {
            transform: scale(0.98);
        }

        /* Results Phase */
        .results-screen {
            padding: 20px 0;
        }

        .results-header {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
        }

        .results-title {
            color: white;
            font-size: 1.6rem;
            font-weight: 800;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .results-summary {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .correct-answer {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.4));
            border: 1px solid #4CAF50;
            border-radius: 15px;
            padding: 15px;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .results-grid {
            display: grid;
            gap: 18px;
            margin-bottom: 30px;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: 20px;
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .player-result {
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .player-result-info {
            color: white;
        }

        .player-result-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .player-answer {
            font-size: 0.9rem;
            opacity: 0.8;
            font-weight: 500;
        }

        .sips-penalty {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.3), rgba(244, 67, 54, 0.4));
            border: 1px solid #f44336;
            color: #f44336;
            padding: 10px 18px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 0.95rem;
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.2);
        }

        .sips-penalty.none {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.4));
            border-color: #4CAF50;
            color: #4CAF50;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.2);
        }

        /* Final Results Screen */
        .final-results-screen {
            padding: 20px 0;
        }

        .final-header {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.3));
            border: 2px solid rgba(255, 215, 0, 0.5);
            backdrop-filter: blur(30px);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
        }

        .final-title {
            color: #FFD700;
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .final-subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .final-stats {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            color: white;
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .leaderboard {
            margin: 30px 0;
        }

        .leaderboard-title {
            color: white;
            font-size: 1.4rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
        }

        .leaderboard-item {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 1px solid rgba(255, 255, 255, 0.25);
        }

        .leaderboard-item.winner {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.3));
            border-color: #FFD700;
        }

        .rank-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.2rem;
        }

        .rank-1 { background: linear-gradient(135deg, #FFD700, #FFA500); color: white; }
        .rank-2 { background: linear-gradient(135deg, #C0C0C0, #A0A0A0); color: white; }
        .rank-3 { background: linear-gradient(135deg, #CD7F32, #B8860B); color: white; }
        .rank-other { background: rgba(255, 255, 255, 0.2); color: white; }

        .player-final-stats {
            flex: 1;
        }

        .player-final-name {
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .player-final-details {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            display: flex;
            gap: 15px;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: grid;
            gap: 18px;
            margin-top: 25px;
        }

        .nav-btn {
            padding: 20px;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .nav-btn.secondary {
            background: rgba(255, 255, 255, 0.12);
            border: 2px solid rgba(255, 255, 255, 0.25);
            color: white;
            backdrop-filter: blur(20px);
        }

        .nav-btn:active {
            transform: scale(0.98);
        }

        /* Toast Notifications */
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            padding: 20px;
            z-index: 10000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 350px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .toast-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast-notification.success {
            border-color: rgba(76, 175, 80, 0.5);
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(76, 175, 80, 0.25));
        }

        .toast-notification.warning {
            border-color: rgba(255, 152, 0, 0.5);
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.15), rgba(255, 152, 0, 0.25));
        }

        .toast-notification.error {
            border-color: rgba(244, 67, 54, 0.5);
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.15), rgba(244, 67, 54, 0.25));
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
        }

        .toast-icon {
            font-size: 1.5rem;
        }

        .toast-message {
            font-weight: 600;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .app-container {
                padding: 12px;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .number-btn {
                width: 50px;
                height: 50px;
                font-size: 1.1rem;
            }

            .final-stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .player-final-details {
                flex-direction: column;
                gap: 5px;
            }
        }

        /* Animations */
        .fadeInUp {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Background Particles -->
    <div class="background-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- App Container -->
    <div class="app-container">
        <!-- Game Header -->
        <div class="game-header fadeInUp">
            <div class="game-info">
                <div class="device-mode">📱 Ein Gerät</div>
                <div class="question-counter">Frage <span id="question-number">1</span> von 10</div>
            </div>
            <div class="players-info">
                <div class="players-indicator"></div>
                <span id="players-count">0 Spieler</span>
            </div>
        </div>

        <!-- PHASE 1: Question & Answer -->
        <div class="game-phase active" id="question-phase">
            <!-- Question Card -->
            <div class="question-card fadeInUp">
                <div class="question-category" id="question-category">
                    🎮 Loading...
                </div>
                <div class="question-text" id="question-text">
                    Lade Frage...
                </div>
            </div>

            <!-- Current Player -->
            <div class="current-player-card fadeInUp">
                <div class="player-avatar" id="current-avatar">M</div>
                <div class="player-info">
                    <div class="player-name" id="current-player-name">Max</div>
                    <div class="player-status">Du bist dran! <span id="player-progress">(1/4)</span></div>
                </div>
            </div>

            <!-- Answer Section -->
            <div class="answer-section fadeInUp">
                <div class="answer-title">🤔 Deine Antwort</div>
                <div class="answer-buttons">
                    <button class="answer-btn yes" onclick="selectAnswer(true)" id="yes-btn">
                        <div class="answer-emoji">✅</div>
                        <div>Ja, habe ich</div>
                    </button>
                    <button class="answer-btn no" onclick="selectAnswer(false)" id="no-btn">
                        <div class="answer-emoji">❌</div>
                        <div>Nein, noch nie</div>
                    </button>
                </div>
            </div>

            <!-- Estimation Section -->
            <div class="estimation-section fadeInUp">
                <div class="estimation-title">🎯 Wie viele antworten mit "Ja"?</div>
                
                <!-- Current Selection Display -->
                <div class="current-selection">
                    <div class="selection-display">
                        <div class="selection-number" id="selected-number">1</div>
                        <div class="selection-label">von <span id="total-players">0</span> Spielern</div>
                    </div>
                </div>

                <!-- Number Grid -->
                <div class="number-grid" id="number-grid">
                    <!-- Numbers will be generated dynamically -->
                </div>
            </div>

            <!-- Submit Button -->
            <div class="submit-section fadeInUp">
<button class="submit-btn" onclick="submitAnswer()" id="submit-btn">
                    📤 Antwort bestätigen
                </button>
            </div>
        </div>

        <!-- PHASE 2: Round Results -->
        <div class="game-phase" id="results-phase">
            <div class="results-screen">
                <div class="results-header fadeInUp">
                    <div class="results-title">📊 Ergebnis Frage <span id="results-round">1</span></div>
                    <div class="results-summary" id="results-summary">
                        Berechne Ergebnisse...
                    </div>
                    <div class="correct-answer">
                        ✅ Korrekte Antwort: <span id="correct-count">0</span> Spieler
                    </div>
                </div>

                <div class="results-grid fadeInUp" id="results-grid">
                    <!-- Results will be populated dynamically -->
                </div>

                <div class="nav-buttons fadeInUp">
                    <button class="nav-btn primary" onclick="nextQuestion()" id="next-question-btn">
                        ➡️ Nächste Frage
                    </button>
                </div>
            </div>
        </div>

        <!-- PHASE 3: Final Results -->
        <div class="game-phase" id="final-results-phase">
            <div class="final-results-screen">
                <div class="final-header fadeInUp">
                    <div class="final-title">🏆 Spiel beendet!</div>
                    <div class="final-subtitle">Hier sind die Gesamtergebnisse</div>
                    
                    <div class="final-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="total-questions">10</div>
                            <div class="stat-label">Fragen gespielt</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="total-players-final">0</div>
                            <div class="stat-label">Spieler</div>
                        </div>
                    </div>
                </div>

                <div class="leaderboard fadeInUp">
                    <div class="leaderboard-title">🏅 Bestenliste</div>
                    <div id="leaderboard-list">
                        <!-- Leaderboard will be populated dynamically -->
                    </div>
                </div>

                <div class="nav-buttons fadeInUp">
                    <button class="nav-btn primary" onclick="playAgain()">
                        🔄 Nochmal spielen
                    </button>
                    <button class="nav-btn secondary" onclick="goHome()">
                        🏠 Zur Startseite
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== GAME STATE MANAGEMENT =====
        class GameState {
            constructor() {
                this.deviceMode = null;
                this.selectedCategories = [];
                this.difficulty = null;
                this.players = [];
                this.gameId = null;
                this.playerName = null;
                this.isHost = false;
                this.isGuest = false;
                this.gameState = 'setup';
                this.timestamp = Date.now();
                
                this.loadFromStorage();
            }

            loadFromStorage() {
                try {
                    const saved = localStorage.getItem('denkstdu_game_state');
                    if (saved) {
                        const state = JSON.parse(saved);
                        if (state.timestamp && Date.now() - state.timestamp < 24 * 60 * 60 * 1000) {
                            // Lade nur die relevanten Properties
                            this.deviceMode = state.deviceMode || null;
                            this.selectedCategories = state.selectedCategories || [];
                            this.difficulty = state.difficulty || null;
                            this.players = state.players || [];
                            this.gameId = state.gameId || null;
                            this.playerName = state.playerName || null;
                            this.isHost = state.isHost || false;
                            this.isGuest = state.isGuest || false;
                            this.gameState = state.gameState || 'setup';
                            
                            console.log('✅ GameState loaded from storage:', this);
                            return true;
                        } else {
                            console.log('⚠️ GameState expired, clearing storage');
                            this.clearStorage();
                        }
                    }
                } catch (error) {
                    console.error('❌ Could not load game state:', error);
                    this.clearStorage();
                }
                return false;
            }

            clearStorage() {
                localStorage.removeItem('denkstdu_game_state');
            }
        }

        // ===== GLOBAL VARIABLES =====
        let gameState = null;
        let currentGame = {
            players: [],
            questions: [],
            currentRound: 1,
            totalRounds: 10,
            currentPlayerIndex: 0,
            currentAnswers: {},
            currentEstimates: {},
            allAnswers: {},
            allEstimates: {},
            roundResults: []
        };

        // Questions Database
        const questionsDatabase = {
            fsk0: [
                "Ich habe schon mal... ein ganzes Buch an einem Tag gelesen",
                "Ich habe schon mal... Pizza zum Frühstück gegessen", 
                "Ich habe schon mal... mehr als 12 Stunden am Stück geschlafen",
                "Ich habe schon mal... einen ganzen Tag im Pyjama verbracht",
                "Ich habe schon mal... beim Kochen das Essen anbrennen lassen",
                "Ich habe schon mal... mein Handy in die Toilette fallen lassen",
                "Ich habe schon mal... ein Lied komplett falsch mitgesungen",
                "Ich habe schon mal... heimlich Süßigkeiten vor dem Abendessen gegessen",
                "Ich habe schon mal... so getan, als würde ich schlafen",
                "Ich habe schon mal... einen Film dreimal hintereinander geschaut"
            ],
            fsk16: [
                "Ich habe schon mal... so getan, als wäre ich krank, um nicht zur Schule zu müssen",
                "Ich habe schon mal... bis 3 Uhr morgens Netflix geschaut",
                "Ich habe schon mal... ein Lied so laut gesungen, dass die Nachbarn sich beschwert haben",
                "Ich habe schon mal... vergessen, wo ich mein Auto geparkt habe",
                "Ich habe schon mal... bei einer Prüfung geschummelt",
                "Ich habe schon mal... heimlich das Tagebuch von jemand anderem gelesen",
                "Ich habe schon mal... gelogen, um aus einer Verabredung herauszukommen",
                "Ich habe schon mal... mich richtig betrunken",
                "Ich habe schon mal... eine ganze Nacht durchgemacht",
                "Ich habe schon mal... heimlich geraucht"
            ],
            fsk18: [
                "Ich habe schon mal... einen peinlichen Betrunkenheits-Text verschickt",
                "Ich habe schon mal... mich in eine Person verliebt, die vergeben war",
                "Ich habe schon mal... bei einem Date gelogen, um interessanter zu wirken",
                "Ich habe schon mal... heimlich die Social Media Profile meines Ex gecheckt",
                "Ich habe schon mal... einen One-Night-Stand gehabt",
                "Ich habe schon mal... fremdgegangen",
                "Ich habe schon mal... nackt gebadet",
                "Ich habe schon mal... in der Öffentlichkeit geknutscht",
                "Ich habe schon mal... über mein Liebesleben gelogen",
                "Ich habe schon mal... Nacktbilder verschickt"
            ]
        };

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
        });

        function initializeGame() {
            console.log('🎮 Initializing single device gameplay...');
            
            // Load game state
            gameState = new GameState();
            
            // Validate game state
            if (!gameState.players || gameState.players.length < 2) {
                showNotification('Keine Spieler gefunden!', 'error');
                setTimeout(() => window.location.href = 'player-setup.html', 2000);
                return;
            }

            if (!gameState.selectedCategories || gameState.selectedCategories.length === 0) {
                showNotification('Keine Kategorien ausgewählt!', 'error');
                setTimeout(() => window.location.href = 'category-selection.html', 2000);
                return;
            }

            if (!gameState.difficulty) {
                showNotification('Kein Schwierigkeitsgrad ausgewählt!', 'error');
                setTimeout(() => window.location.href = 'difficulty-selection.html', 2000);
                return;
            }

            // Setup game
            currentGame.players = [...gameState.players];
            currentGame.questions = generateQuestions();
            
            // Initialize UI
            updateGameDisplay();
            createNumberGrid();
            
            // Start first round
            startNewRound();
            
            console.log('✅ Game initialized:', {
                players: currentGame.players,
                categories: gameState.selectedCategories,
                difficulty: gameState.difficulty,
                questions: currentGame.questions.length
            });
        }

        function generateQuestions() {
            let allQuestions = [];
            
            gameState.selectedCategories.forEach(category => {
                if (questionsDatabase[category]) {
                    questionsDatabase[category].forEach(q => {
                        allQuestions.push({
                            text: q,
                            category: category
                        });
                    });
                }
            });
            
            // Shuffle and take 10
            return shuffleArray(allQuestions).slice(0, currentGame.totalRounds);
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // ===== GAME FLOW =====
        function updateGameDisplay() {
            document.getElementById('question-number').textContent = currentGame.currentRound;
            document.getElementById('players-count').textContent = `${currentGame.players.length} Spieler`;
            document.getElementById('total-players').textContent = currentGame.players.length;
            
            // Update current player
            const currentPlayerName = currentGame.players[currentGame.currentPlayerIndex];
            document.getElementById('current-player-name').textContent = currentPlayerName;
            document.getElementById('current-avatar').textContent = currentPlayerName.charAt(0).toUpperCase();
            document.getElementById('player-progress').textContent = 
                `(${currentGame.currentPlayerIndex + 1}/${currentGame.players.length})`;
        }

        function startNewRound() {
            console.log(`🎲 Starting round ${currentGame.currentRound}`);
            
            // Reset for new round
            currentGame.currentPlayerIndex = 0;
            currentGame.currentAnswers = {};
            currentGame.currentEstimates = {};
            
            // Load question
            const question = currentGame.questions[currentGame.currentRound - 1];
            loadQuestion(question);
            
            // Reset UI
            resetPlayerUI();
            updateGameDisplay();
            
            // Show question phase
            showPhase('question');
        }

        function loadQuestion(question) {
            const categoryNames = {
                'fsk0': '👨‍👩‍👧‍👦 Familie & Freunde',
                'fsk16': '🎉 Party Time',
                'fsk18': '🔥 Heiß & Gewagt'
            };
            
            document.getElementById('question-text').textContent = question.text;
            document.getElementById('question-category').textContent = categoryNames[question.category] || '🎮 Spiel';
        }

        function resetPlayerUI() {
            // Reset answer buttons
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Reset number selection
            updateSelectedNumber(Math.floor(currentGame.players.length / 2));
            updateNumberSelection();
            updateSubmitButton();
        }

        // ===== UI CONTROLS =====
        function createNumberGrid() {
            const numberGrid = document.getElementById('number-grid');
            numberGrid.innerHTML = '';

            for (let i = 0; i <= currentGame.players.length; i++) {
                const numberBtn = document.createElement('button');
                numberBtn.className = 'number-btn';
                numberBtn.textContent = i;
                numberBtn.onclick = () => selectNumber(i);
                numberBtn.id = `number-btn-${i}`;
                
                numberGrid.appendChild(numberBtn);
            }
            
            updateNumberSelection();
        }

        function selectNumber(number) {
            if (number >= 0 && number <= currentGame.players.length) {
                currentEstimation = number;
                updateSelectedNumber(number);
                updateNumberSelection();
                updateSubmitButton();
                
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
            }
        }

        function updateSelectedNumber(number) {
            document.getElementById('selected-number').textContent = number;
            
            const selectionDisplay = document.querySelector('.selection-display');
            selectionDisplay.style.transform = 'scale(1.1)';
            setTimeout(() => {
                selectionDisplay.style.transform = 'scale(1)';
            }, 200);
        }

        function updateNumberSelection() {
            document.querySelectorAll('.number-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            const selectedBtn = document.getElementById(`number-btn-${currentEstimation}`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
            }
        }

        function selectAnswer(answer) {
            currentAnswer = answer;
            
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            const selectedBtn = answer ? document.getElementById('yes-btn') : document.getElementById('no-btn');
            selectedBtn.classList.add('selected');
            
            updateSubmitButton();
        }

        function updateSubmitButton() {
            const submitBtn = document.getElementById('submit-btn');
            if (currentAnswer !== null) {
                submitBtn.classList.add('enabled');
                submitBtn.disabled = false;
            } else {
                submitBtn.classList.remove('enabled');
                submitBtn.disabled = true;
            }
        }

        // ===== GAME ACTIONS =====
        let currentAnswer = null;
        let currentEstimation = 1;

        function submitAnswer() {
            if (currentAnswer === null) {
                showNotification('Bitte wähle eine Antwort aus!', 'warning');
                return;
            }

            const currentPlayerName = currentGame.players[currentGame.currentPlayerIndex];
            
            // Save answers
            currentGame.currentAnswers[currentPlayerName] = currentAnswer;
            currentGame.currentEstimates[currentPlayerName] = currentEstimation;
            
            console.log(`📤 ${currentPlayerName} answered:`, {
                answer: currentAnswer,
                estimation: currentEstimation
            });

            showNotification(`${currentPlayerName}: ${currentAnswer ? 'JA' : 'NEIN'} (Tipp: ${currentEstimation})`, 'success', 2000);
            
            // Move to next player or show results
            setTimeout(() => {
                if (currentGame.currentPlayerIndex < currentGame.players.length - 1) {
                    currentGame.currentPlayerIndex++;
                    currentAnswer = null;
                    currentEstimation = Math.floor(currentGame.players.length / 2);
                    resetPlayerUI();
                    updateGameDisplay();
                } else {
                    showResults();
                }
            }, 1500);
        }

        // ===== RESULTS =====
        function showResults() {
            console.log('📊 Calculating results...');
            
            // Calculate actual yes count
            const actualYesCount = Object.values(currentGame.currentAnswers).filter(answer => answer === true).length;
            
            // Calculate results for each player
            const results = currentGame.players.map(playerName => {
                const answer = currentGame.currentAnswers[playerName];
                const estimation = currentGame.currentEstimates[playerName];
                const difference = Math.abs(estimation - actualYesCount);
                const isCorrect = difference === 0;
                
                // Calculate sips based on difficulty
                let sips = 0;
                if (!isCorrect) {
                    const baseSips = getDifficultyMultiplier();
                    sips = baseSips + difference;
                }
                
                return {
                    playerName: playerName,
                    answer: answer,
                    estimation: estimation,
                    difference: difference,
                    isCorrect: isCorrect,
                    sips: sips
                };
            });
            
            // Save round result
            currentGame.roundResults.push({
                round: currentGame.currentRound,
                question: currentGame.questions[currentGame.currentRound - 1],
                actualYesCount: actualYesCount,
                results: results
            });
            
            // Display results
            displayRoundResults(results, actualYesCount);
            showPhase('results');
        }

        function getDifficultyMultiplier() {
            switch (gameState.difficulty) {
                case 'easy': return 1;
                case 'hard': return 3;
                default: return 2; // medium
            }
        }

        function displayRoundResults(results, actualYesCount) {
            // Update summary
            document.getElementById('results-round').textContent = currentGame.currentRound;
            document.getElementById('results-summary').textContent = 
                `${actualYesCount} von ${currentGame.players.length} Spielern haben mit "Ja" geantwortet`;
            document.getElementById('correct-count').textContent = actualYesCount;

            // Display individual results
            const resultsGrid = document.getElementById('results-grid');
            resultsGrid.innerHTML = '';

            results.forEach(result => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                
                const avatar = result.playerName.substring(0, 2).toUpperCase();
                const answerText = result.answer ? 'Ja' : 'Nein';
                const sipsText = result.sips === 0 ? 'Perfekt! 🎯' : `${result.sips} 🍺`;
                const sipsClass = result.sips === 0 ? 'none' : '';

                resultItem.innerHTML = `
                    <div class="player-result">
                        <div class="player-avatar">${avatar}</div>
                        <div class="player-result-info">
                            <div class="player-result-name">${result.playerName}</div>
                            <div class="player-answer">${answerText} • Tipp: ${result.estimation}</div>
                        </div>
                    </div>
                    <div class="sips-penalty ${sipsClass}">${sipsText}</div>
                `;

                resultsGrid.appendChild(resultItem);
            });

            // Update next question button
            const nextBtn = document.getElementById('next-question-btn');
            if (currentGame.currentRound >= currentGame.totalRounds) {
                nextBtn.textContent = '🏆 Endergebnisse anzeigen';
                nextBtn.onclick = showFinalResults;
            }
        }

        function nextQuestion() {
            if (currentGame.currentRound >= currentGame.totalRounds) {
                showFinalResults();
                return;
            }
            
            currentGame.currentRound++;
            startNewRound();
            showNotification('Neue Frage geladen! 🎮', 'success');
        }

        // ===== FINAL RESULTS =====
        function showFinalResults() {
            console.log('🏆 Calculating final results...');
            
            // Calculate final statistics
            const playerStats = currentGame.players.map(playerName => {
                let totalSips = 0;
                let correctGuesses = 0;
                let totalGuesses = 0;

                currentGame.roundResults.forEach(roundResult => {
                    const playerResult = roundResult.results.find(r => r.playerName === playerName);
                    if (playerResult) {
                        totalSips += playerResult.sips;
                        totalGuesses++;
                        if (playerResult.isCorrect) {
                            correctGuesses++;
                        }
                    }
                });

                const accuracy = totalGuesses > 0 ? Math.round((correctGuesses / totalGuesses) * 100) : 0;
                const score = correctGuesses * 10 - totalSips; // Simple scoring system

                return {
                    playerName: playerName,
                    totalSips: totalSips,
                    correctGuesses: correctGuesses,
                    totalGuesses: totalGuesses,
                    accuracy: accuracy,
                    score: score
                };
            });

            // Sort by score (higher is better)
            const finalRankings = playerStats.sort((a, b) => b.score - a.score);
            
            // Display final results
            displayFinalResults(finalRankings);
            showPhase('final-results');
        }

        function displayFinalResults(finalRankings) {
            // Update final stats
            document.getElementById('total-questions').textContent = currentGame.totalRounds;
            document.getElementById('total-players-final').textContent = currentGame.players.length;
            
            // Build leaderboard
            const leaderboardList = document.getElementById('leaderboard-list');
            leaderboardList.innerHTML = '';
            
            finalRankings.forEach((player, index) => {
                const leaderboardItem = document.createElement('div');
                leaderboardItem.className = `leaderboard-item ${index === 0 ? 'winner' : ''}`;
                
                const rankClass = index === 0 ? 'rank-1' : 
                                 index === 1 ? 'rank-2' : 
                                 index === 2 ? 'rank-3' : 'rank-other';
                
                leaderboardItem.innerHTML = `
                    <div class="rank-number ${rankClass}">${index + 1}</div>
                    <div class="player-final-stats">
                        <div class="player-final-name">${player.playerName}</div>
                        <div class="player-final-details">
                            <span>Schlücke: ${player.totalSips}</span>
                            <span>Genauigkeit: ${player.accuracy}%</span>
                            <span>Punkte: ${player.score}</span>
                        </div>
                    </div>
                `;
                
                leaderboardList.appendChild(leaderboardItem);
            });

            showNotification('Spiel beendet! 🏆', 'success');
        }

        // ===== PHASE MANAGEMENT =====
        function showPhase(phase) {
            document.querySelectorAll('.game-phase').forEach(p => {
                p.classList.remove('active');
            });
            
            document.getElementById(`${phase}-phase`).classList.add('active');
            
            console.log(`📍 Phase changed to: ${phase}`);
        }

        // ===== NAVIGATION =====
        function playAgain() {
            if (confirm('Möchtest du ein neues Spiel starten?')) {
                // Reset game state but keep players
                currentGame.currentRound = 1;
                currentGame.currentPlayerIndex = 0;
                currentGame.currentAnswers = {};
                currentGame.currentEstimates = {};
                currentGame.roundResults = [];
                currentGame.questions = generateQuestions();
                
                startNewRound();
                showNotification('Neues Spiel gestartet! 🎮', 'success');
            }
        }

        function goHome() {
            if (confirm('Spiel wirklich verlassen?')) {
                localStorage.removeItem('denkstdu_game_state');
                window.location.href = 'index.html';
            }
        }

        // ===== UTILITY FUNCTIONS =====
        function showNotification(message, type = 'info', duration = 3000) {
            // Remove existing notifications
            document.querySelectorAll('.toast-notification').forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `toast-notification ${type}`;
            notification.innerHTML = `
                <div class="toast-content">
                    <div class="toast-icon">${type === 'success' ? '✅' : type === 'warning' ? '⚠️' : type === 'error' ? '❌' : 'ℹ️'}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Remove after duration
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, duration);
        }

        // ===== DEBUG FUNCTIONS =====
        window.debugGame = function() {
            console.log('🔍 Game Debug Info:');
            console.log('GameState:', gameState);
            console.log('Current Game:', currentGame);
        };

        window.skipToFinal = function() {
            showFinalResults();
        };

        console.log('✅ Single Device Gameplay loaded');
        console.log('🎮 Debug Commands:');
        console.log('- debugGame() - Show debug info');
        console.log('- skipToFinal() - Skip to final results');
    </script>
</body>
</html>